<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Tree drawing and exploration (web) &#8212; ETE Toolkit 4.0.0-beta2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=12dfc556" />
    <script src="../_static/documentation_options.js?v=382e6e0c"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tree drawing (Qt)" href="tutorial_treeview.html" />
    <link rel="prev" title="Phylogenetic trees" href="tutorial_phylogeny.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="tree-drawing-and-exploration-web">
<h1><a class="toc-backref" href="#id1" role="doc-backlink">Tree drawing and exploration (web)</a><a class="headerlink" href="#tree-drawing-and-exploration-web" title="Link to this heading">¶</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#tree-drawing-and-exploration-web" id="id1">Tree drawing and exploration (web)</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id2">Overview</a></p></li>
<li><p><a class="reference internal" href="#explore-interactive-visualization-of-trees" id="id3">Explore interactive visualization of trees</a></p>
<ul>
<li><p><a class="reference internal" href="#standalone-scripts" id="id4">Standalone scripts</a></p></li>
<li><p><a class="reference internal" href="#interactive-sessions" id="id5">Interactive sessions</a></p></li>
<li><p><a class="reference internal" href="#verbose-mode" id="id6">Verbose mode</a></p></li>
<li><p><a class="reference internal" href="#show-leaf-node-names-branch-length-and-branch-support" id="id7">Show leaf node names, branch length and branch support</a></p></li>
<li><p><a class="reference internal" href="#showing-node-s-properties-in-pop-up" id="id8">Showing node’s properties in pop up</a></p></li>
<li><p><a class="reference internal" href="#control-panel" id="id9">Control Panel</a></p>
<ul>
<li><p><a class="reference internal" href="#layout-tab" id="id10">1) Layout Tab</a></p>
<ul>
<li><p><a class="reference internal" href="#overrall" id="id11">Overrall</a></p></li>
<li><p><a class="reference internal" href="#download" id="id12">Download</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#search-selection-tab" id="id13">2) Search &amp; Selection Tab</a></p>
<ul>
<li><p><a class="reference internal" href="#simple-search" id="id14">Simple search</a></p></li>
<li><p><a class="reference internal" href="#regular-expression-search" id="id15">Regular expression search</a></p></li>
<li><p><a class="reference internal" href="#expression-search" id="id16">Expression search</a></p></li>
<li><p><a class="reference internal" href="#topological-search" id="id17">Topological search</a></p></li>
<li><p><a class="reference internal" href="#examples-of-searches-and-possible-matches" id="id18">Examples of searches and possible matches</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-tab" id="id19">3) Advanced Tab</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#node-panel" id="id20">Node Panel</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#customizing-the-aspect-of-trees" id="id21">Customizing the aspect of trees</a></p>
<ul>
<li><p><a class="reference internal" href="#tree-layout" id="id22">Tree Layout</a></p></li>
<li><p><a class="reference internal" href="#tree-style" id="id23">Tree Style</a></p>
<ul>
<li><p><a class="reference internal" href="#customizing-tree-style" id="id24">Customizing tree style</a></p></li>
<li><p><a class="reference internal" href="#add-legend" id="id25">Add legend</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#node-style" id="id26">Node style</a></p></li>
<li><p><a class="reference internal" href="#node-faces" id="id27">Node faces</a></p>
<ul>
<li><p><a class="reference internal" href="#faces-position" id="id28">Faces position</a></p></li>
<li><p><a class="reference internal" href="#face-for-collapsed-clades" id="id29">Face for collapsed clades</a></p></li>
<li><p><a class="reference internal" href="#face-properties" id="id30">Face properties</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#advanced-layout-functions" id="id31">Advanced Layout functions</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#combining-styles-faces-and-layouts" id="id32">Combining styles, faces and layouts</a></p>
<ul>
<li><p><a class="reference internal" href="#fixed-node-styles-faces-and-tree-style" id="id33">Fixed node styles, faces and tree style</a></p></li>
<li><p><a class="reference internal" href="#define-layout-objects" id="id34">Define Layout objects</a></p></li>
<li><p><a class="reference internal" href="#node-backgrounds" id="id35">Node Backgrounds</a></p></li>
<li><p><a class="reference internal" href="#color-strip" id="id36">Color Strip</a></p></li>
<li><p><a class="reference internal" href="#outlined-collapsed-clade" id="id37">Outlined Collapsed Clade</a></p></li>
<li><p><a class="reference internal" href="#bar-plot" id="id38">Bar Plot</a></p></li>
<li><p><a class="reference internal" href="#heatmap" id="id39">Heatmap</a></p></li>
<li><p><a class="reference internal" href="#visualize-multiple-sequence-alignment-and-domain" id="id40">Visualize Multiple Sequence Alignment and Domain</a></p></li>
<li><p><a class="reference internal" href="#domain-annotation" id="id41">Domain annotation</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<section id="overview">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Overview</a><a class="headerlink" href="#overview" title="Link to this heading">¶</a></h2>
<p>Before exploring the novel features and enhancements introduced in ETE
v4, it is essential to understand the foundational elements of ETE’s
programmable tree drawing engine. Inherited from ETE v3, the following
fundamental components form a highly adaptable backbone, enabling the
various customization and structuring of visualizations:</p>
<ol class="loweralpha simple">
<li><p>TreeStyle, a class can be used to create a custom set of options
that control the general aspect of the tree image. For example,
users can modify the scale used to render tree branches or choose
between circular or rectangular tree drawing, and customize general
settings for tree visualizing such as title, footer, legend, etc.</p></li>
<li><p>NodeStyle, defines the specific aspect of each node (size, color,
background, line type, etc.). A node style can be defined
statically and attached to several nodes, or customized the
conditions so different NodeStyle applied for nodes in different
conditions. NodeStyle can even dynamically change on the fly to
adapt ETE4’s zooming algorithm, which can be set through a
TreeLayout.</p></li>
<li><p>Face, as called as node faces, are small pieces of extra graphical
information that can be linked to nodes (text labels, images,
graphs, etc.). Several types of node faces are provided by the
previous ETE3 module, ranging from simple text (TextFace) and
geometric shapes (CircleFace), to molecular sequence
representations (SequenceFace), etc. These faces are upgraded in
ETE4 to adapt the large tree drawing engine.</p></li>
<li><p>TreeLayout, is a class which defines a foundational layout for
trees to set specific styles for both the entire tree and
individual nodes, acting as a pre-drawing hooking framework. When a
tree is about to be drawn, the above elements such as TreeStyle,
NodeStyle, Face of nodes can be then set up and modified on the fly
and returned to the drawer engine. Hence TreeLayout class can be
understood as a suite of rules tree’s basic setting and how
different nodes should be drawn.</p></li>
</ol>
<p>Scheme of fundamental components in ETE4’s programmable tree drawing engine</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/fundamental_ete4.jpg?raw=true" />
</section>
<section id="explore-interactive-visualization-of-trees">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Explore interactive visualization of trees</a><a class="headerlink" href="#explore-interactive-visualization-of-trees" title="Link to this heading">¶</a></h2>
<p>ETE’s tree drawing engine is fully integrated with a built-in
graphical user interface (GUI) which allows to explore and manipulate
node’s properties and tree topology. To start the visualization of a
node (tree or subtree), you can simply call the <a class="reference internal" href="../reference/reference_tree.html#ete4.Tree.explore" title="ete4.Tree.explore"><code class="xref py py-func docutils literal notranslate"><span class="pre">explore</span></code></a> method.</p>
<p>One of the advantages of this visualization is that you can use it to
interrupt a given program/analysis, explore the tree, manipulate it,
and continue with the execution. Note that <strong>changes made using the
GUI will be kept after quiting the GUI</strong>. This feature is specially
useful during python sessions, and it can be utilized in various environments
by modifying argument <em>keep_server</em>, including standalone scripts and interactive
sessions such as IPython or Jupyter Notebooks. Below are examples demonstrating
the method’s usage in each context.</p>
<section id="standalone-scripts">
<h3><a class="toc-backref" href="#id4" role="doc-backlink">Standalone scripts</a><a class="headerlink" href="#standalone-scripts" title="Link to this heading">¶</a></h3>
<p>When running a standalone script, <em>keep_server</em> should be set as <em>True</em> to keep
the server running.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/explore_standalone.py">explore_standalone.py
example</a>.</p>
</section>
<section id="interactive-sessions">
<h3><a class="toc-backref" href="#id5" role="doc-backlink">Interactive sessions</a><a class="headerlink" href="#interactive-sessions" title="Link to this heading">¶</a></h3>
<p>When running in interactive sessions such as IPython or Jupyter Notebooks,
leave <em>keep_server</em> as default <em>False</em>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="mf">3.9.7</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Sep</span> <span class="mi">16</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">58</span><span class="p">)</span>
<span class="n">Type</span> <span class="s1">&#39;copyright&#39;</span><span class="p">,</span> <span class="s1">&#39;credits&#39;</span> <span class="ow">or</span> <span class="s1">&#39;license&#39;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span>
<span class="n">IPython</span> <span class="mf">7.29.0</span> <span class="o">--</span> <span class="n">An</span> <span class="n">enhanced</span> <span class="n">Interactive</span> <span class="n">Python</span><span class="o">.</span> <span class="n">Type</span> <span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">help</span><span class="o">.</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Added</span> <span class="n">tree</span> <span class="n">tree</span><span class="o">-</span><span class="mi">1</span> <span class="k">with</span> <span class="nb">id</span> <span class="mf">0.</span>
</pre></div>
</div>
</section>
<section id="verbose-mode">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Verbose mode</a><a class="headerlink" href="#verbose-mode" title="Link to this heading">¶</a></h3>
<p>When running in verbose mode by setting <em>quiet</em> argument, every actions
will be printed in the terminal.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Python</span> <span class="mf">3.9.7</span> <span class="p">(</span><span class="n">default</span><span class="p">,</span> <span class="n">Sep</span> <span class="mi">16</span> <span class="mi">2021</span><span class="p">,</span> <span class="mi">13</span><span class="p">:</span><span class="mi">09</span><span class="p">:</span><span class="mi">58</span><span class="p">)</span>
<span class="n">Type</span> <span class="s1">&#39;copyright&#39;</span><span class="p">,</span> <span class="s1">&#39;credits&#39;</span> <span class="ow">or</span> <span class="s1">&#39;license&#39;</span> <span class="k">for</span> <span class="n">more</span> <span class="n">information</span>
<span class="n">IPython</span> <span class="mf">7.29.0</span> <span class="o">--</span> <span class="n">An</span> <span class="n">enhanced</span> <span class="n">Interactive</span> <span class="n">Python</span><span class="o">.</span> <span class="n">Type</span> <span class="s1">&#39;?&#39;</span> <span class="k">for</span> <span class="n">help</span><span class="o">.</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">1</span><span class="p">]:</span> <span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">2</span><span class="p">]:</span> <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>

<span class="n">In</span> <span class="p">[</span><span class="mi">3</span><span class="p">]:</span> <span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">quiet</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">Added</span> <span class="n">tree</span> <span class="n">tree</span><span class="o">-</span><span class="mi">1</span> <span class="k">with</span> <span class="nb">id</span> <span class="mf">0.</span>
<span class="n">Bottle</span> <span class="n">v0</span><span class="mf">.12.25</span> <span class="n">server</span> <span class="n">starting</span> <span class="n">up</span> <span class="p">(</span><span class="n">using</span> <span class="n">WSGIRefServer</span><span class="p">())</span><span class="o">...</span>

<span class="n">Listening</span> <span class="n">on</span> <span class="n">http</span><span class="p">:</span><span class="o">//</span><span class="n">localhost</span><span class="p">:</span><span class="mi">5000</span><span class="o">/</span>
<span class="n">Hit</span> <span class="n">Ctrl</span><span class="o">-</span><span class="n">C</span> <span class="n">to</span> <span class="n">quit</span><span class="o">.</span>

<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET / HTTP/1.1&quot;</span> <span class="mi">303</span> <span class="mi">0</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">29</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /layouts HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">106</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/size HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">29</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/collapse_size HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">2</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /drawers/RectFaces/0 HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">30</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/ultrametric HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">5</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/nodecount HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">27</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /layouts/0 HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">106</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/searches HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">16</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/all_selections HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">16</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/all_active HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">27</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/draw?drawer=RectFaces&amp;min_size=10&amp;zx=555.9&amp;zy=284.40000000000003&amp;za=1&amp;x=-0.33333333333333337&amp;y=-0.16666666666666666&amp;w=3.3333333333333335&amp;h=3.333333333333333&amp;collapsed_ids=%5B%5D&amp;layouts=%5B</span><span class="si">%22d</span><span class="s2">efault%3ABranch+length</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%22d</span><span class="s2">efault%3ABranch+support</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%22d</span><span class="s2">efault%3ALeaf+name</span><span class="si">%22%</span><span class="s2">5D&amp;ultrametric=0 HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">1765</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /drawers/RectFaces/0 HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">30</span>
<span class="mf">127.0.0.1</span> <span class="o">-</span> <span class="o">-</span> <span class="p">[</span><span class="mi">02</span><span class="o">/</span><span class="n">Nov</span><span class="o">/</span><span class="mi">2023</span> <span class="mi">11</span><span class="p">:</span><span class="mi">19</span><span class="p">:</span><span class="mi">15</span><span class="p">]</span> <span class="s2">&quot;GET /trees/0/draw?drawer=RectFaces&amp;min_size=10&amp;zx=555.9&amp;zy=284.40000000000003&amp;za=1&amp;x=-0.33333333333333337&amp;y=-0.16666666666666666&amp;w=3.3333333333333335&amp;h=3.333333333333333&amp;collapsed_ids=%5B%5D&amp;layouts=%5B</span><span class="si">%22d</span><span class="s2">efault%3ABranch+length</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%22d</span><span class="s2">efault%3ABranch+support</span><span class="si">%22%</span><span class="s2">2C</span><span class="si">%22d</span><span class="s2">efault%3ALeaf+name</span><span class="si">%22%</span><span class="s2">5D&amp;ultrametric=0&amp;panel=-1 HTTP/1.1&quot;</span> <span class="mi">200</span> <span class="mi">2</span>
</pre></div>
</div>
</section>
<section id="show-leaf-node-names-branch-length-and-branch-support">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">Show leaf node names, branch length and branch support</a><a class="headerlink" href="#show-leaf-node-names-branch-length-and-branch-support" title="Link to this heading">¶</a></h3>
<p>Users can choose to show leaf node names, branch length and branch support in the
tree explore method.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">show_leaf_name</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">show_branch_length</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> \
<span class="n">show_branch_support</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/explore_show.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/explore_show.py">explore_show.py example</a>.</p>
</section>
<section id="showing-node-s-properties-in-pop-up">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">Showing node’s properties in pop up</a><a class="headerlink" href="#showing-node-s-properties-in-pop-up" title="Link to this heading">¶</a></h3>
<p>Users can choose to show node’s properties in pop up when mouse left-click on the node.
By setting arguments in <em>include_props</em> and <em>exclude_props</em> <cite>explore()</cite> method, users can choose to show node’s
properties in pop up when mouse left-click on the node, uses can decide what
properties to show in interface.</p>
<p>Example using <em>include_props</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># includes node&#39;s properties &quot;name&quot;, &quot;dist&quot; and &quot;support&quot; in pop up</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">include_props</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;support&quot;</span><span class="p">),</span> <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Or <em>exclude_props</em>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
 <span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
 <span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
 <span class="c1"># not showing node&#39;s properties &quot;dist&quot; and &quot;support&quot; in pop up</span>
 <span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">exclude_props</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;support&quot;</span><span class="p">),</span> <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="control-panel">
<h3><a class="toc-backref" href="#id9" role="doc-backlink">Control Panel</a><a class="headerlink" href="#control-panel" title="Link to this heading">¶</a></h3>
<p>After trigging explore() method on target tree, a local browser will be activated where users can visualize targer tree.
When exploring the tree, a control panel will be shown in the left side of the tree panel.</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/control_panel.png?raw=true" />
<p>It consists of the three major tabs:</p>
<ul class="simple">
<li><p><strong>Layout</strong>: overrall setting of the tree layout including tree representation, collapse level, available TreeLayouts, etc.</p></li>
<li><p><strong>Search &amp; Selection</strong>: to customize search and select nodes in the tree.</p></li>
<li><p><strong>Advanced</strong>: to control the advanced options of the tree visualization setting.</p></li>
</ul>
<section id="layout-tab">
<h4><a class="toc-backref" href="#id10" role="doc-backlink">1) Layout Tab</a><a class="headerlink" href="#layout-tab" title="Link to this heading">¶</a></h4>
<section id="overrall">
<h5><a class="toc-backref" href="#id11" role="doc-backlink">Overrall</a><a class="headerlink" href="#overrall" title="Link to this heading">¶</a></h5>
<p>Layout tab contains most of the general settings of the tree visualization. It includes:</p>
<ul class="simple">
<li><p><strong>tree</strong>, name of the tree.</p></li>
<li><p><strong>drawer</strong>, drawer of the tree representation, <em>Rectangular</em> or <em>Circular</em>.</p></li>
<li><p><strong>collapse</strong>, the threshold of the vertical size in pixel, when the node’s vertical size is smaller than the threshold, the node will be collapsed, default value is <em>10</em>.</p></li>
<li><p><strong>ultrametric</strong>, whether to draw ultrametric tree with edge lengths where all leaves are equidistant from the root, default <em>False</em>.</p></li>
<li><p><strong>Layouts</strong>, all available TreeLayouts in the tree, users can choose to activate or deactivate the TreeLayouts.</p></li>
<li><p><strong>show minimap</strong>, whether to show minimap in the tree interface(bottom-right), default <em>False</em>.</p></li>
<li><p><strong>show tree scale legend</strong>, whether to show tree scale legend in the tree interface(bottom-left), default <em>True</em>.</p></li>
<li><p><strong>tooltip on hover</strong>, whether to show tooltip when mouse hover on the node. If <em>False</em>, tooltip will be shown on left-click. Default <em>False</em>.</p></li>
<li><p><strong>smart zoom</strong>, If set to True, SmartView will adjust the horizontal and vertical zoom so that the current node under the cursor tends to occupy the full area. The default setting is <strong>True</strong>.</p></li>
<li><p><strong>zoom in aligned panel</strong>, If set to True, users can zoom in the aligned panel for aligned node faces. The default setting is <strong>False</strong>.</p></li>
<li><p><strong>select text</strong>, whether is able to select text with cursor in the tree interface, default <em>False</em>.</p></li>
<li><p><strong>Download</strong>, users can download the tree information in <strong>newick</strong>, <strong>svg</strong> or <strong>pdf</strong> file in the tree interface by clicking the download tab from Control Panel.</p></li>
<li><p><strong>Help</strong>, help page for SmartView, including shortcuts.</p></li>
</ul>
</section>
<section id="download">
<h5><a class="toc-backref" href="#id12" role="doc-backlink">Download</a><a class="headerlink" href="#download" title="Link to this heading">¶</a></h5>
<p>Users can download the tree information in <strong>newick</strong>, <strong>svg</strong> or <strong>pdf</strong> file in the tree interface by clicking the download tab from Control Panel.</p>
</section>
</section>
<section id="search-selection-tab">
<h4><a class="toc-backref" href="#id13" role="doc-backlink">2) Search &amp; Selection Tab</a><a class="headerlink" href="#search-selection-tab" title="Link to this heading">¶</a></h4>
<p>Search &amp; Selection tab contains the search and selection functions of the tree visualization.
Users can start query with clicking <em>new search</em> button, then input the query in the search box.
Each query will be saved in the search history, users can choose to modtify the visualizing setting for matching nodes or clades.</p>
<section id="simple-search">
<h5><a class="toc-backref" href="#id14" role="doc-backlink">Simple search</a><a class="headerlink" href="#simple-search" title="Link to this heading">¶</a></h5>
<p>Put a text in the search box to find all the nodes whose name matches it.
The search will be case-insensitive if the text is all in lower case, and case-sensitive otherwise.</p>
</section>
<section id="regular-expression-search">
<h5><a class="toc-backref" href="#id15" role="doc-backlink">Regular expression search</a><a class="headerlink" href="#regular-expression-search" title="Link to this heading">¶</a></h5>
<p>To search for names mathing a given regular expression, you can prefix your text with the command <strong>/r</strong> (the regexp command) and follow it with the regular expression.</p>
</section>
<section id="expression-search">
<h5><a class="toc-backref" href="#id16" role="doc-backlink">Expression search</a><a class="headerlink" href="#expression-search" title="Link to this heading">¶</a></h5>
<p>When prefixing your text with /e (the eval command), you can use a quite general Python expression to search for nodes. This is the most powerful search method available (and the most complex to use).</p>
<p>The expression will be evaluated for every node, and will select those that satisfy it. In the expression you can use (among others) the following variables, with their straightforward interpretation: <strong>node</strong>, <strong>parent</strong>, <strong>is_leaf</strong>, <strong>length</strong> / <strong>dist</strong> / <strong>d</strong>, <strong>properties</strong> / <strong>p</strong>, <strong>children</strong> / <strong>ch</strong>, <strong>size</strong>, <strong>dx</strong>, <strong>dy</strong>, <strong>regex</strong>.</p>
</section>
<section id="topological-search">
<h5><a class="toc-backref" href="#id17" role="doc-backlink">Topological search</a><a class="headerlink" href="#topological-search" title="Link to this heading">¶</a></h5>
<p>Similar to the expression search, if you prefix your text with <strong>/t</strong> (the topological command), you can write a newick tree with quoted names in each node containing an eval command. This will select the nodes that satisfy the full subtree of expressions that you passed.</p>
</section>
<section id="examples-of-searches-and-possible-matches">
<h5><a class="toc-backref" href="#id18" role="doc-backlink">Examples of searches and possible matches</a><a class="headerlink" href="#examples-of-searches-and-possible-matches" title="Link to this heading">¶</a></h5>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">citrobacter</span>           <span class="n">will</span> <span class="n">match</span> <span class="n">nodes</span> <span class="n">named</span> <span class="s2">&quot;Citrobacter werkmanii&quot;</span> <span class="ow">and</span> <span class="s2">&quot;Citrobacter youngae&quot;</span>

<span class="n">UBA</span>           <span class="n">will</span> <span class="n">match</span> <span class="s2">&quot;spx UBA2009&quot;</span> <span class="n">but</span> <span class="ow">not</span> <span class="s2">&quot;Rokubacteriales&quot;</span>

<span class="o">/</span><span class="n">r</span> <span class="n">sp</span>\<span class="n">d</span>\<span class="n">d</span>             <span class="n">will</span> <span class="n">match</span> <span class="nb">any</span> <span class="n">name</span> <span class="n">that</span> <span class="n">contains</span> <span class="s2">&quot;sp&quot;</span> <span class="n">followed</span> <span class="n">by</span> <span class="p">(</span><span class="n">at</span> <span class="n">least</span><span class="p">)</span> <span class="n">two</span> <span class="n">digits</span><span class="p">,</span> <span class="n">like</span> <span class="s2">&quot;Escherichia sp002965065&quot;</span> <span class="ow">and</span> <span class="s2">&quot;Citrobacter sp005281345&quot;</span>

<span class="o">/</span><span class="n">e</span> <span class="n">d</span> <span class="o">&gt;</span> <span class="mi">1</span>              <span class="n">will</span> <span class="n">match</span> <span class="n">nodes</span> <span class="k">with</span> <span class="n">a</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span>

<span class="o">/</span><span class="n">e</span> <span class="n">is_leaf</span> <span class="ow">and</span> <span class="n">p</span><span class="p">[</span><span class="s1">&#39;species&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Homo&#39;</span>         <span class="n">will</span> <span class="n">match</span> <span class="n">leaf</span> <span class="n">nodes</span> <span class="k">with</span> <span class="nb">property</span> <span class="s2">&quot;species&quot;</span> <span class="n">equal</span> <span class="n">to</span> <span class="s2">&quot;Homo&quot;</span>

<span class="o">/</span><span class="n">t</span> <span class="p">(</span><span class="s2">&quot;is_leaf&quot;</span><span class="p">,</span><span class="s2">&quot;d &gt; 1&quot;</span><span class="p">)</span><span class="s2">&quot;name==&#39;AB&#39;&quot;</span>            <span class="n">will</span> <span class="n">match</span> <span class="n">nodes</span> <span class="n">named</span> <span class="s2">&quot;AB&quot;</span> <span class="n">that</span> <span class="n">have</span> <span class="n">two</span> <span class="n">children</span><span class="p">,</span> <span class="n">one</span> <span class="n">that</span> <span class="ow">is</span> <span class="n">a</span> <span class="n">leaf</span> <span class="ow">and</span> <span class="n">another</span> <span class="n">that</span> <span class="n">has</span> <span class="n">a</span> <span class="n">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
</pre></div>
</div>
</section>
</section>
<section id="advanced-tab">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">3) Advanced Tab</a><a class="headerlink" href="#advanced-tab" title="Link to this heading">¶</a></h4>
<p>For more advance set up for visualization.</p>
</section>
</section>
<section id="node-panel">
<h3><a class="toc-backref" href="#id20" role="doc-backlink">Node Panel</a><a class="headerlink" href="#node-panel" title="Link to this heading">¶</a></h3>
<p>Interactive tree explorer allows users to perform various editing options on specific node. Once right-click on target node, it trigger node panel for selecting editing options.</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/nodepanel.png?raw=true" />
<p>The node editor panel provides access to node-specific actions, such as creating subtrees, collapsing, pruning, rooting and more.</p>
</section>
</section>
<section id="customizing-the-aspect-of-trees">
<h2><a class="toc-backref" href="#id21" role="doc-backlink">Customizing the aspect of trees</a><a class="headerlink" href="#customizing-the-aspect-of-trees" title="Link to this heading">¶</a></h2>
<p>Visualization customization is performed through four main elements: <em>TreeStyle</em>, <em>NodeStyle</em>, <em>Face</em>, and <em>TreeLayout</em>.</p>
<section id="tree-layout">
<h3><a class="toc-backref" href="#id22" role="doc-backlink">Tree Layout</a><a class="headerlink" href="#tree-layout" title="Link to this heading">¶</a></h3>
<p>As shown in scheme of fundamental components from the previous section, TreeLayout contains element of
tree style, node style and faces. Therefore, TreeLayout is the most important element in ETE4’s drawing engine
in regards to visualize information other than pure tree topology. TreeLayout can be called from <code class="xref py py-class docutils literal notranslate"><span class="pre">TreeLayout</span></code>
from <code class="xref py py-class docutils literal notranslate"><span class="pre">ete4.smartview:</span></code>. It contains the following arguments:</p>
<ul class="simple">
<li><p><em>name</em>: name of the TreeLayout object, obligatory field.</p></li>
<li><p><em>ts</em>: a function to set tree style.</p></li>
<li><p><em>ns</em>: a function to set node style.</p></li>
<li><p><em>aligned_faces</em>: whether to draw faces in aligned position, default <em>False</em>.</p></li>
<li><p><em>active</em>: whether to activate the TreeLayout, default <em>True</em>.</p></li>
<li><p><em>legend</em>: whether to show legend(need to be defined in tree style function), default <em>False</em>.</p></li>
</ul>
<p>Here we demonstrate the basic usage of TreeLayout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># define a TreeLayout</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">)</span>

<span class="c1"># add TreeLayout to layouts</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>

<span class="c1"># explore tree</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/treelayout_1.jpg?raw=true" />
<p>As the red frame highlighted the TreeLayout name, which is defined as “MyTreeLayout” is shown
and activated in tree panel.</p>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/treelayout_1.py">treelayout_1.py example</a>.</p>
</section>
<section id="tree-style">
<h3><a class="toc-backref" href="#id23" role="doc-backlink">Tree Style</a><a class="headerlink" href="#tree-style" title="Link to this heading">¶</a></h3>
<p>a class can be used to create a custom set of options that control the general aspect of
the tree image. For example, users can modify the scale used to render tree branches or
choose between circular or rectangular tree drawing, and customize general settings for
tree visualizing such as title, footer, legend, etc</p>
<p>A number of parameters can be controlled through custom tree style
objects. Check the <code class="xref py py-class docutils literal notranslate"><span class="pre">TreeStyle</span></code> documentation for a complete
list of accepted values.</p>
<p>As we described in the previous section, to modify tree style, we could define a function
and pass it to the TreeLayout class which defined as custom layout for futher explore.</p>
<p>In the following, we show some common cases to modify tree style.</p>
<section id="customizing-tree-style">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">Customizing tree style</a><a class="headerlink" href="#customizing-tree-style" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span>

<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">modify_tree_style</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">collapse_size</span> <span class="o">=</span> <span class="mi">70</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">modify_tree_style</span><span class="p">)</span>

<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/treestyle_1.py">treestyle_1.py example</a>.</p>
</section>
<section id="add-legend">
<h4><a class="toc-backref" href="#id25" role="doc-backlink">Add legend</a><a class="headerlink" href="#add-legend" title="Link to this heading">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">modify_tree_style</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>

    <span class="c1"># add legend</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MyLegend&quot;</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;a&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;c&quot;</span><span class="p">:</span><span class="s2">&quot;green&quot;</span><span class="p">}</span>
        <span class="p">)</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ts</span><span class="o">=</span><span class="n">modify_tree_style</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/treestyle_legend.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/treestyle_legend.py">treestyle_legend.py example</a>.</p>
</section>
</section>
<section id="node-style">
<h3><a class="toc-backref" href="#id26" role="doc-backlink">Node style</a><a class="headerlink" href="#node-style" title="Link to this heading">¶</a></h3>
<p>Through the <code class="xref py py-class docutils literal notranslate"><span class="pre">NodeStyle</span></code> class the aspect of each single node
can be controlled, including its size, color, background and branch
type.</p>
<p>A node style can be defined statically and attached to several nodes.
Here is the full list of attributtes that can be modified of node style, which is stored in <cite>node.sm_style</cite> :</p>
<ul class="simple">
<li><p><em>fgcolor</em>, foreground color, color thats appear in node, i.e. <em>red</em> or #ff0000 in hex code, default <em>#0030c1</em>.</p></li>
<li><p><em>bgcolor</em>, background color, background color of node, default <em>transparent</em>.</p></li>
<li><p><em>outline_line_color</em>, border color of the triangle when node is collapsed, default <em>#000000</em>.</p></li>
<li><p><em>outline_line_width</em>, border width of the triangle when node is collapsed, default <em>0.5</em>.</p></li>
<li><p><em>outline_color</em>, color of the triangle when node is collapsed, default <em>#e5e5e5</em>.</p></li>
<li><p><em>outline_opacity</em>, opacity of the triangle when node is collapsed, default <em>0.3</em>.</p></li>
<li><p><em>vt_line_color</em>, color of verticle line of node, default <em>#000000</em>.</p></li>
<li><p><em>hz_line_color</em>, color of horizontal line of node, default <em>#000000</em>.</p></li>
<li><p><em>hz_line_type</em>, type of horizontal line of node, default <em>0</em>, options are 0 solid, 1 dashed, 2 dotted.</p></li>
<li><p><em>vt_line_type</em>, type pf verticle line of node, default <em>0</em>, options are 0 solid, 1 dashed, 2 dotted.</p></li>
<li><p><em>hz_line_width</em>, size of horizontal line of node, default <em>0.5</em>.</p></li>
<li><p><em>vt_line_width</em>, size of verticle line of node, default <em>0.5</em>.</p></li>
<li><p><em>size</em>, diameter of node, default <em>0</em> piexl.</p></li>
<li><p><em>shape</em>, shape of node, default <em>circle</em>, options are <em>circle</em>, <em>square</em>, <em>triangle</em>.</p></li>
<li><p><em>draw_descendants</em>, whether to draw descendants of node or collapse node, default <em>True</em>.</p></li>
</ul>
<p>Using <cite>set_style()</cite> method can add the node style of a node.</p>
<p>Simple tree in which the same style is applied to all nodes:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">NodeStyle</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((A,B),C);&#39;</span><span class="p">)</span>

<span class="c1"># Draw nodes as small red square of diameter equal fo 10 pixels</span>
<span class="n">triangle_node_style</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;triangle&quot;</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>

<span class="c1"># brown dashed branch lines with width equal to 2 pixels</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;hz_line_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;hz_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">triangle_node_style</span><span class="p">[</span><span class="s2">&quot;hz_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#964B00&quot;</span>

<span class="c1"># Applies the same static style to all nodes in the tree. Note that,</span>
<span class="k">def</span> <span class="nf">modify_node_style</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">triangle_node_style</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_node_style</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/nodestyle_triangle.png?raw=true" />
<p>Now in legend of the layout shows in top-right corner of the tree panel.</p>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/nodestyle_triangle.py">nodestyle_triangle.py example</a>.</p>
<p>If you want to draw nodes with different styles, an independent
<code class="xref py py-class docutils literal notranslate"><span class="pre">NodeStyle</span></code> instance must be created for each node.</p>
<p>Simple tree in which the different styles are applied to each node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">NodeStyle</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>

<span class="c1"># Draw nodes as small red square of diameter equal fo 10 pixels</span>
<span class="c1"># Create an independent node style for each node, which is</span>
<span class="c1"># initialized with a red foreground color.</span>
<span class="n">leaf_style</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">leaf_style</span><span class="p">[</span><span class="s2">&quot;shape&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;square&quot;</span>
<span class="n">leaf_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">leaf_style</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span>

<span class="c1"># we set the foreground color to blue and the size to 30 for the root node</span>
<span class="n">root_style</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">root_style</span><span class="p">[</span><span class="s2">&quot;fgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;blue&quot;</span>
<span class="n">root_style</span><span class="p">[</span><span class="s2">&quot;size&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">root_style</span><span class="p">[</span><span class="s2">&quot;vt_line_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">root_style</span><span class="p">[</span><span class="s2">&quot;vt_line_width&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">root_style</span><span class="p">[</span><span class="s2">&quot;vt_line_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;#964B00&quot;</span>

<span class="c1"># Draw nodes as small red square of diameter equal fo 10 pixels</span>
<span class="k">def</span> <span class="nf">modify_node_style</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="c1"># Let&#39;s now modify the aspect of the leaf nodes</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">leaf_style</span><span class="p">)</span>
    <span class="c1"># Let&#39;s now modify the aspect of the root node</span>
    <span class="c1"># Check if the node is the root node</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">root_style</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_node_style</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/nodestyle_different.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/nodestyle_different.py">nodestyle_different.py example</a>.</p>
</section>
<section id="node-faces">
<h3><a class="toc-backref" href="#id27" role="doc-backlink">Node faces</a><a class="headerlink" href="#node-faces" title="Link to this heading">¶</a></h3>
<p>Node faces are small pieces of graphical information that can be
linked to nodes. For instance, text labels or external images could be
linked to nodes and they will be plotted within the tree image.</p>
<p>Several types of node faces are provided by the main <code class="xref py py-mod docutils literal notranslate"><span class="pre">smartview</span></code>
module, ranging from simple text (<code class="xref py py-class docutils literal notranslate"><span class="pre">TextFace</span></code>) and geometric
shapes (<code class="xref py py-class docutils literal notranslate"><span class="pre">CircleFace</span></code>) or (<code class="xref py py-class docutils literal notranslate"><span class="pre">RectFace</span></code>), to molecular sequence representations
(<code class="xref py py-class docutils literal notranslate"><span class="pre">SeqFace</span></code>), and specific faces for collapsed clade (<code class="xref py py-class docutils literal notranslate"><span class="pre">OutlinedFace</span></code>), etc.</p>
<p>A complete list of available faces can be found at the <code class="xref py py-mod docutils literal notranslate"><span class="pre">smartview</span></code>
reference page. All node faces example with demonstration code can be found in
<a class="reference external" href="https://github.com/dengzq1234/ete4_gallery">https://github.com/dengzq1234/ete4_gallery</a>.</p>
<section id="faces-position">
<h4><a class="toc-backref" href="#id28" role="doc-backlink">Faces position</a><a class="headerlink" href="#faces-position" title="Link to this heading">¶</a></h4>
<p>Faces can be added to different areas around the node, namely
<strong>branch_right</strong>, <strong>branch_top</strong>, <strong>branch_bottom</strong> or <strong>aligned</strong>.
Each area represents a table in which faces can be added through the
<a class="reference internal" href="../reference/reference_tree.html#ete4.Tree.add_face" title="ete4.Tree.add_face"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_face</span></code></a> method. For instance, if you
want two text labels drawn below the branch line of a given node, a
pair of <code class="xref py py-class docutils literal notranslate"><span class="pre">TextFace</span></code> faces can be created and added to the
columns 0 and 1 of the <strong>branch_bottom</strong> area:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a:1,b:1):1,c:1)Root:1;&#39;</span><span class="p">)</span>

<span class="c1"># Draw nodes text face in root node</span>
<span class="k">def</span> <span class="nf">modify_face_position</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_root</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Hola!&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_bottom&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;mundo!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_bottom&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_face_position</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_bottom_1.png?raw=true" />
<p>If we set the column of “mundo” text face as 0</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="o">.....</span>
  <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;mundo!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_bottom&#39;</span><span class="p">)</span>
<span class="o">.....</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_bottom_2.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_bottom.py">faceposition_bottom.py example</a>.</p>
<p>If you add more than one face to the same area and column, they will
be piled up. If position set <strong>aligned</strong>, the face of node will be drawn
aligned in an aligned column. If doing so, TreeLayout’s argument <strong>aligned_faces</strong>
should be set as <strong>True</strong> to avoid the tree node’s name overlapped with node faces.</p>
<p><strong>aligned</strong> position example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a,b),c);&#39;</span><span class="p">)</span>

<span class="c1"># Draw nodes text face in leaf node</span>
<span class="k">def</span> <span class="nf">modify_face_position</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Hola!&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;mundo!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># set aligned_faces=True because we want to align the faces</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_face_position</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>See the following image</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_aligned.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_aligned.py">faceposition_aligned.py example</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Once a face object is created, it can be linked to one or more
nodes. For instance, the same text label can be recycled and added
to several nodes.</p>
</div>
</section>
<section id="face-for-collapsed-clades">
<h4><a class="toc-backref" href="#id29" role="doc-backlink">Face for collapsed clades</a><a class="headerlink" href="#face-for-collapsed-clades" title="Link to this heading">¶</a></h4>
<p>A notable feature in smartview in ete4 is able to collapse clades in the tree.
When a clade is collapsed, a triangle will be drawn as default in the node. Therefore,
a face can be added to the collapsed clade to show more information.</p>
<p>For node faces in collapsed clades, modify <em>collapsed_only</em> argument to True in method
<a class="reference internal" href="../reference/reference_tree.html#ete4.Tree.add_face" title="ete4.Tree.add_face"><code class="xref py py-func docutils literal notranslate"><span class="pre">add_face</span></code></a></p>
<p><strong>collapsed_only</strong> example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a:1,b:1)n1:1,c):1;&#39;</span><span class="p">)</span>

<span class="c1"># Draw nodes text face in node with name n1</span>
<span class="k">def</span> <span class="nf">modify_face_position</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="c1"># find node with name n1</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;n1&quot;</span><span class="p">:</span>
        <span class="c1"># write text face &quot;Hola&quot; in node n1 and show it in branch_right directly</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Hola!&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_right&#39;</span><span class="p">,</span> <span class="n">collapsed_only</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="c1"># write text face &quot;Hola&quot; in node n1 and show it in branch_right only when node is collapsed</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;mundo!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_right&#39;</span><span class="p">,</span> <span class="n">collapsed_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_face_position</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>“Hola” TextFace shown in branch_right of node “n1” directly with argument <strong>collapsed_only=False</strong></p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_collapsed_before.png?raw=true" />
<p>“mundo” TextFace shown in branch_right of node “n1” only when node is collapsed with argument <strong>collapsed_only=True</strong></p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_collapsed_after.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_collapsed.py">faceposition_collapsed.py example</a>.</p>
<p>Example of all face positions</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_all.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceposition_all.py">faceposition_all.py example</a>.</p>
</section>
<section id="face-properties">
<h4><a class="toc-backref" href="#id30" role="doc-backlink">Face properties</a><a class="headerlink" href="#face-properties" title="Link to this heading">¶</a></h4>
<p>Each face instance has its specific config values, although all face
instances contain the same basic attributes that permit to modify
general aspects such as padding, etc.  In order to explore the properties of each face,
a complete list of face attributes can be found in
each <code class="xref py py-class docutils literal notranslate"><span class="pre">Face</span></code> class documentation, such as <code class="xref py py-class docutils literal notranslate"><span class="pre">TextFace</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">RectFace</span></code>, etc.
Here is a very simple example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((a:1,b:1):1,c:1):1;&#39;</span><span class="p">)</span>

<span class="n">top_textface</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;branch top!&quot;</span><span class="p">)</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="mi">6</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="mi">25</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="s1">&#39;courier&#39;</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">padding_x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">padding_y</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">top_textface</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c1"># or all together</span>
<span class="n">bottom_textface</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;branch bottom!&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


<span class="c1"># Draw nodes text face in root node</span>
<span class="k">def</span> <span class="nf">modify_face_property</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">top_textface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_top&#39;</span><span class="p">)</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">bottom_textface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;branch_bottom&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">modify_face_property</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceproperties_textface.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/faceproperties_textface.py">faceproperties_textface.py example</a>.</p>
</section>
</section>
<section id="advanced-layout-functions">
<h3><a class="toc-backref" href="#id31" role="doc-backlink">Advanced Layout functions</a><a class="headerlink" href="#advanced-layout-functions" title="Link to this heading">¶</a></h3>
<p>Layout functions act as pre-drawing <a class="reference external" href="http://en.wikipedia.org/wiki/Hooking">hooking functions</a>. This means that, before a
node is drawn, it is first sent to a layout function. Node properties,
style and faces can be then modified on the fly and returned to the
drawing engine. Thus, layout functions can be understood as a
collection of rules controlling how different nodes should be drawn.</p>
<p>Wrap in function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a,b),c),d),e);&#39;</span><span class="p">)</span>

<span class="c1"># here to modfiy node style directly inside the function</span>
<span class="k">def</span> <span class="nf">vowel_node_layout</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">vowels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">}</span>

    <span class="c1"># here to set the node style</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">vowels</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>


<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">vowel_node_layout</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/advance_layout_1.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/advance_layout.py">advance_layout.py example</a>.</p>
</section>
</section>
<section id="combining-styles-faces-and-layouts">
<h2><a class="toc-backref" href="#id32" role="doc-backlink">Combining styles, faces and layouts</a><a class="headerlink" href="#combining-styles-faces-and-layouts" title="Link to this heading">¶</a></h2>
<section id="fixed-node-styles-faces-and-tree-style">
<h3><a class="toc-backref" href="#id33" role="doc-backlink">Fixed node styles, faces and tree style</a><a class="headerlink" href="#fixed-node-styles-faces-and-tree-style" title="Link to this heading">¶</a></h3>
<p>example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a,b),c),d),e);&#39;</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">vowel_tree_style</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Vowel title&quot;</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_panel_header</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;MyLegend&quot;</span><span class="p">,</span>
        <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
        <span class="n">colormap</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vowel&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;conostant&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">}</span>
        <span class="p">)</span>

<span class="k">def</span> <span class="nf">vowel_node_layout</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="n">vowels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">}</span>

    <span class="c1"># here to set the node style</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">vowels</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;red&#39;</span>
            <span class="c1"># here to add text face to node in aligned position</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;vowel!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;blue&#39;</span>

            <span class="c1"># here to add text face to node in aligned position</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="s1">&#39;not vowel!&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>


<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">vowel_tree_style</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">vowel_node_layout</span><span class="p">,</span>
    <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>


<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>Combined node styles, faces and tree style into one TreeLayout:</p>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/combinedlayout_basic.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/combinedlayout_basic.py">combinedlayout_basic.py example</a>.</p>
</section>
<section id="define-layout-objects">
<h3><a class="toc-backref" href="#id34" role="doc-backlink">Define Layout objects</a><a class="headerlink" href="#define-layout-objects" title="Link to this heading">¶</a></h3>
<p>As we showed above, layout functions can be passed to the TreeLayout
class to create a TreeLayout object. Therefore we can define our own
customized layout.</p>
<p>Example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a,b),c),d),e);&#39;</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">MyTreeLayout</span><span class="p">(</span><span class="n">TreeLayout</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;My First TreeLayout&quot;</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">vowel_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">conostant_color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="n">vowel_node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">conostant_node_size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="c1"># Ensuring that any initialization that TreeLayout needs to do is done,</span>
        <span class="c1"># before MyTreeLayout goes on to do its own additional initialization.</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="n">min_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vowel_color</span> <span class="o">=</span> <span class="n">vowel_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conostant_color</span> <span class="o">=</span> <span class="n">conostant_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vowel_node_size</span> <span class="o">=</span> <span class="n">vowel_node_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conostant_node_size</span> <span class="o">=</span> <span class="n">conostant_node_size</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aligned_faces</span> <span class="o">=</span> <span class="n">aligned_faces</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column</span> <span class="o">=</span> <span class="n">column</span>


    <span class="k">def</span> <span class="nf">set_tree_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">style</span><span class="p">):</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span><span class="p">,</span>
            <span class="n">max_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">)</span>

        <span class="n">style</span><span class="o">.</span><span class="n">aligned_panel_header</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">)</span>
        <span class="n">style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
            <span class="n">title</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="n">colormap</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;vowel&quot;</span><span class="p">:</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;conostant&quot;</span><span class="p">:</span><span class="s2">&quot;blue&quot;</span><span class="p">}</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_node_style</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">node</span><span class="p">):</span>
        <span class="n">vowels</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;i&#39;</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="s1">&#39;u&#39;</span><span class="p">}</span>
        <span class="n">vowel_textface</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;vowel&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">vowel_color</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span>
        <span class="p">)</span>

        <span class="n">conostant_textface</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span>
            <span class="n">text</span><span class="o">=</span><span class="s2">&quot;not vowel!&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">conostant_color</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span>
        <span class="p">)</span>

        <span class="c1"># here to set the node style</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">vowels</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vowel_node_size</span>
                <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vowel_color</span>

                <span class="c1"># here to add text face to node in aligned position</span>
                <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">vowel_textface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conostant_node_size</span>
                <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s1">&#39;fgcolor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conostant_color</span>

                <span class="c1"># here to add text face to node in aligned position</span>
                <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">conostant_textface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">column</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>


<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">MyTreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/combinedlayout_basic.png?raw=true" />
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/combinedlayout_object.py">combinedlayout_object.py example</a>.</p>
</section>
<section id="node-backgrounds">
<h3><a class="toc-backref" href="#id35" role="doc-backlink">Node Backgrounds</a><a class="headerlink" href="#node-backgrounds" title="Link to this heading">¶</a></h3>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/node_backgrounds.png?raw=true" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">NodeStyle</span><span class="p">,</span> <span class="n">TextFace</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a1,a2),a3), ((b1,b2),(b3,b4))), ((c1,c2),c3));&#39;</span><span class="p">)</span>

<span class="c1"># set background color for difference node style</span>
<span class="n">nst1</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">nst1</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;LightSteelBlue&quot;</span>
<span class="n">nst2</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">nst2</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Moccasin&quot;</span>
<span class="n">nst3</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">nst3</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;DarkSeaGreen&quot;</span>
<span class="n">nst4</span> <span class="o">=</span> <span class="n">NodeStyle</span><span class="p">()</span>
<span class="n">nst4</span><span class="p">[</span><span class="s2">&quot;bgcolor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Khaki&quot;</span>

<span class="c1"># find common ancestors</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">])</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">,</span> <span class="s2">&quot;b3&quot;</span><span class="p">,</span> <span class="s2">&quot;b4&quot;</span><span class="p">])</span>
<span class="n">n3</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">])</span>
<span class="n">n4</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;b3&quot;</span><span class="p">,</span> <span class="s2">&quot;b4&quot;</span><span class="p">])</span>

<span class="c1"># set color map dictionary</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ancestor_a&quot;</span><span class="p">:</span> <span class="s2">&quot;LightSteelBlue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_b&quot;</span><span class="p">:</span> <span class="s2">&quot;Moccasin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_c&quot;</span><span class="p">:</span> <span class="s2">&quot;DarkSeaGreen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_d&quot;</span><span class="p">:</span> <span class="s2">&quot;Khaki&quot;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
        <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MyLegend&quot;</span><span class="p">,</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">add_legend</span>

<span class="k">def</span> <span class="nf">get_background</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="c1"># make node name with bigger text</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">TextFace</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">25</span><span class="p">),</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s2">&quot;branch_right&quot;</span><span class="p">)</span>
    <span class="c1"># set node style</span>
    <span class="k">if</span> <span class="n">node</span> <span class="o">==</span> <span class="n">n1</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">nst1</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span> <span class="o">==</span> <span class="n">n2</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">nst2</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span> <span class="o">==</span> <span class="n">n3</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">nst3</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span> <span class="o">==</span> <span class="n">n4</span><span class="p">:</span>
        <span class="n">node</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="n">nst4</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">get_background</span><span class="p">,</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">),</span>
    <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/node_backgrounds.py">node_backgrounds.py example</a>.</p>
</section>
<section id="color-strip">
<h3><a class="toc-backref" href="#id36" role="doc-backlink">Color Strip</a><a class="headerlink" href="#color-strip" title="Link to this heading">¶</a></h3>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/colorstrip.png?raw=true" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">RectFace</span><span class="p">,</span> <span class="n">TextFace</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a1,a2),a3), ((b1,b2),(d1,d2))), ((c1,c2),c3));&#39;</span><span class="p">)</span>

<span class="c1"># find common ancestors and annotate them</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">])</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">])</span>
<span class="n">n3</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">])</span>
<span class="n">n4</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;d1&quot;</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">])</span>
<span class="n">n1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_a&quot;</span>
<span class="n">n2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_b&quot;</span>
<span class="n">n3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_c&quot;</span>
<span class="n">n4</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_d&quot;</span>

<span class="c1"># set color map dictionary</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ancestor_a&quot;</span><span class="p">:</span> <span class="s2">&quot;LightSteelBlue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_b&quot;</span><span class="p">:</span> <span class="s2">&quot;Moccasin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_c&quot;</span><span class="p">:</span> <span class="s2">&quot;DarkSeaGreen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_d&quot;</span><span class="p">:</span> <span class="s2">&quot;Brown&quot;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
        <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MyLegend&quot;</span><span class="p">,</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span>
            <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">add_legend</span>

<span class="k">def</span> <span class="nf">get_node_face</span><span class="p">(</span><span class="n">colormap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_background</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="c1"># make rectangle face</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">colormap</span><span class="p">:</span>
            <span class="n">lca_face</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># circular</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">padding_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">lca_face</span><span class="o">.</span><span class="n">rotate_text</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">lca_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">return</span>
    <span class="k">return</span> <span class="n">get_background</span>


<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">get_node_face</span><span class="p">(</span><span class="n">colormap</span><span class="p">),</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">),</span>
    <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/colorstrip.py">colorstrip.py example</a>.</p>
</section>
<section id="outlined-collapsed-clade">
<h3><a class="toc-backref" href="#id37" role="doc-backlink">Outlined Collapsed Clade</a><a class="headerlink" href="#outlined-collapsed-clade" title="Link to this heading">¶</a></h3>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/outline.png?raw=true" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">RectFace</span><span class="p">,</span> <span class="n">TextFace</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s1">&#39;((((a1,a2),a3), ((b1,b2),(d1,d2))), ((c1,c2),c3));&#39;</span><span class="p">)</span>

<span class="c1"># find common ancestors and annotate them</span>
<span class="n">n1</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;a1&quot;</span><span class="p">,</span> <span class="s2">&quot;a2&quot;</span><span class="p">,</span> <span class="s2">&quot;a3&quot;</span><span class="p">])</span>
<span class="n">n2</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;b1&quot;</span><span class="p">,</span> <span class="s2">&quot;b2&quot;</span><span class="p">])</span>
<span class="n">n3</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;c1&quot;</span><span class="p">,</span> <span class="s2">&quot;c2&quot;</span><span class="p">,</span> <span class="s2">&quot;c3&quot;</span><span class="p">])</span>
<span class="n">n4</span> <span class="o">=</span> <span class="n">t</span><span class="o">.</span><span class="n">common_ancestor</span><span class="p">([</span><span class="s2">&quot;d1&quot;</span><span class="p">,</span> <span class="s2">&quot;d2&quot;</span><span class="p">])</span>
<span class="n">n1</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_a&quot;</span>
<span class="n">n2</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_b&quot;</span>
<span class="n">n3</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_c&quot;</span>
<span class="n">n4</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;ancestor_d&quot;</span>

<span class="c1"># set color map dictionary</span>
<span class="n">colormap</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;ancestor_a&quot;</span><span class="p">:</span> <span class="s2">&quot;LightSteelBlue&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_b&quot;</span><span class="p">:</span> <span class="s2">&quot;Moccasin&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_c&quot;</span><span class="p">:</span> <span class="s2">&quot;DarkSeaGreen&quot;</span><span class="p">,</span>
    <span class="s2">&quot;ancestor_d&quot;</span><span class="p">:</span> <span class="s2">&quot;Brown&quot;</span>
<span class="p">}</span>

<span class="k">def</span> <span class="nf">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">add_legend</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
        <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;MyLegend&quot;</span><span class="p">,</span>
            <span class="n">variable</span> <span class="o">=</span> <span class="s2">&quot;discrete&quot;</span><span class="p">,</span>
            <span class="n">colormap</span> <span class="o">=</span> <span class="n">colormap</span>
            <span class="p">)</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">add_legend</span>

<span class="k">def</span> <span class="nf">get_node_face</span><span class="p">(</span><span class="n">colormap</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_background</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="c1"># make outline face</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">colormap</span><span class="p">:</span>
            <span class="n">lca_face</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># circular</span>
                <span class="n">color</span><span class="o">=</span><span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">),</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                <span class="n">text</span><span class="o">=</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
                <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
                <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
                <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">padding_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">lca_face</span><span class="o">.</span><span class="n">rotate_text</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># collapsed nodes</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s2">&quot;draw_descendants&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">node</span><span class="o">.</span><span class="n">sm_style</span><span class="p">[</span><span class="s2">&quot;outline_color&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colormap</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

            <span class="c1"># show text face</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">lca_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="c1"># show text face even for collapsed nodes</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">lca_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">,</span> <span class="n">collapsed_only</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">return</span>
    <span class="k">return</span> <span class="n">get_background</span>


<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">tree_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;MyTreeLayout&quot;</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">get_node_face</span><span class="p">(</span><span class="n">colormap</span><span class="p">),</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">get_tree_style</span><span class="p">(</span><span class="n">colormap</span><span class="p">),</span>
    <span class="n">active</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tree_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/outline.py">outline.py example</a>.</p>
</section>
<section id="bar-plot">
<h3><a class="toc-backref" href="#id38" role="doc-backlink">Bar Plot</a><a class="headerlink" href="#bar-plot" title="Link to this heading">¶</a></h3>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/barplot.png?raw=true" />
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">RectFace</span><span class="p">,</span> <span class="n">TextFace</span><span class="p">,</span> <span class="n">ScaleFace</span>
<span class="kn">import</span> <span class="nn">random</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># annotate numerical values to each leaf</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">leaves</span><span class="p">():</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add_prop</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">))</span>

<span class="c1"># define tree style function</span>
<span class="k">def</span> <span class="nf">layout_tree_style</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
    <span class="c1"># add scale bar to footer</span>
    <span class="n">scaleface</span> <span class="o">=</span> <span class="n">ScaleFace</span><span class="p">(</span>
        <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sample1&#39;</span><span class="p">,</span>
        <span class="n">width</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
        <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
        <span class="n">scale_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
        <span class="n">tick_width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span>
        <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">formatter</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="p">,</span>
        <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
        <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
        <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
        <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
        <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_panel_header</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">scaleface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_panel_footer</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">scaleface</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># add title to header and footer</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Count&quot;</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_panel_header</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># define node Face layout function</span>
<span class="k">def</span> <span class="nf">layout_barplot</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="n">width</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;count&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.5</span>
        <span class="n">rect_face</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span>
            <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">rect_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">barplot_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BarPlot&#39;</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">layout_barplot</span><span class="p">,</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">layout_tree_style</span><span class="p">,</span>
    <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add layout to layouts list</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">barplot_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">,</span>
    <span class="n">include_props</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;length&quot;</span><span class="p">),</span>
    <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/barplot.py">barplot.py example</a>.</p>
</section>
<section id="heatmap">
<h3><a class="toc-backref" href="#id39" role="doc-backlink">Heatmap</a><a class="headerlink" href="#heatmap" title="Link to this heading">¶</a></h3>
<img alt="alternative text" class="align-center" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/heatmap.png?raw=true" />
<p>Example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">RectFace</span><span class="p">,</span> <span class="n">TextFace</span>
<span class="kn">import</span> <span class="nn">random</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">()</span>
<span class="n">t</span><span class="o">.</span><span class="n">populate</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">random_branches</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># annotate numerical values to each leaf</span>
<span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">leaves</span><span class="p">():</span>
    <span class="n">node</span><span class="o">.</span><span class="n">add_prop</span><span class="p">(</span><span class="s1">&#39;frequence&#39;</span><span class="p">,</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">())</span>

<span class="c1"># define tree style function</span>
<span class="k">def</span> <span class="nf">layout_tree_style</span><span class="p">(</span><span class="n">tree_style</span><span class="p">):</span>
    <span class="c1"># add title to header and footer</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">TextFace</span><span class="p">(</span><span class="s2">&quot;Frequence&quot;</span><span class="p">,</span> <span class="n">min_fsize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_panel_header</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">tree_style</span><span class="o">.</span><span class="n">add_legend</span><span class="p">(</span>
            <span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Frequence&quot;</span><span class="p">,</span>
            <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;continuous&#39;</span><span class="p">,</span>
            <span class="n">value_range</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
            <span class="n">color_range</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;darkred&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">]</span>
            <span class="p">)</span>
    <span class="k">return</span>

<span class="c1"># define node Face layout function</span>
<span class="k">def</span> <span class="nf">layout_heatmap</span><span class="p">(</span><span class="n">mincolor</span><span class="p">,</span> <span class="n">maxcolor</span><span class="p">):</span>
    <span class="c1">#maxval = max(node.props.get(&#39;frequence&#39;) for node in t.leaves())</span>
    <span class="n">maxval</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">minval</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">color_gradient</span><span class="p">(</span><span class="n">c1</span><span class="p">,</span> <span class="n">c2</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Fade (linear interpolate) from color c1 (at mix=0) to c2 (mix=1) &quot;&quot;&quot;</span>
        <span class="n">c1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">c1</span><span class="p">))</span>
        <span class="n">c2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_rgb</span><span class="p">(</span><span class="n">c2</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">mpl</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">to_hex</span><span class="p">((</span><span class="mi">1</span><span class="o">-</span><span class="n">mix</span><span class="p">)</span><span class="o">*</span><span class="n">c1</span> <span class="o">+</span> <span class="n">mix</span><span class="o">*</span><span class="n">c2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_heatmapface</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frequence&#39;</span><span class="p">))</span> <span class="o">/</span> <span class="n">maxval</span>
            <span class="n">gradient_color</span> <span class="o">=</span> <span class="n">color_gradient</span><span class="p">(</span><span class="n">mincolor</span><span class="p">,</span> <span class="n">maxcolor</span><span class="p">,</span> <span class="n">mix</span><span class="o">=</span><span class="n">ratio</span><span class="p">)</span>
            <span class="n">print_frequnce</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;frequence&#39;</span><span class="p">)</span><span class="si">:</span><span class="s2">.2%</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">rect_face</span> <span class="o">=</span> <span class="n">RectFace</span><span class="p">(</span>
                <span class="n">width</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">70</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">gradient_color</span><span class="p">,</span>
                <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">print_frequnce</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">rect_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">,</span> <span class="n">column</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="k">return</span> <span class="n">get_heatmapface</span>

<span class="c1"># Create a TreeLayout object, passing in the function</span>
<span class="n">barplot_layout</span> <span class="o">=</span> <span class="n">TreeLayout</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;HeatMap&#39;</span><span class="p">,</span>
    <span class="n">ns</span><span class="o">=</span><span class="n">layout_heatmap</span><span class="p">(</span><span class="n">mincolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">maxcolor</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">),</span>
    <span class="n">ts</span><span class="o">=</span><span class="n">layout_tree_style</span><span class="p">,</span>
    <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># add layout to layouts list</span>
<span class="n">layouts</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">layouts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">barplot_layout</span><span class="p">)</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span>
    <span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">,</span>
    <span class="n">include_props</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;dist&quot;</span><span class="p">,</span> <span class="s2">&quot;frequence&quot;</span><span class="p">),</span>
    <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/heatmap.py">heatmap.py example</a>.</p>
</section>
<section id="visualize-multiple-sequence-alignment-and-domain">
<h3><a class="toc-backref" href="#id40" role="doc-backlink">Visualize Multiple Sequence Alignment and Domain</a><a class="headerlink" href="#visualize-multiple-sequence-alignment-and-domain" title="Link to this heading">¶</a></h3>
<p>Link to Multiple Sequence Alignment</p>
<img alt="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/msa_layout.png?raw=true" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/msa_layout.png?raw=true" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">SeqFace</span><span class="p">,</span> <span class="n">AlignmentFace</span>


<span class="n">TREEFILE</span> <span class="o">=</span> <span class="s1">&#39;data/tree.nw&#39;</span>
<span class="n">MSA</span> <span class="o">=</span> <span class="s1">&#39;data/tree.aln.faa&#39;</span>


<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">TREEFILE</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">get_seqs</span><span class="p">(</span><span class="n">fastafile</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read a fasta file and return a dict with d[description] = sequence.</span>

<span class="sd">    Example output: {&#39;Phy003I7ZJ_CHICK&#39;: &#39;TMSQFNFSSAPAGGGFSFSTPKT...&#39;, ...}</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name2seq</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">fastafile</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">seq</span><span class="p">:</span>
                <span class="n">name2seq</span><span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span>
                <span class="n">head</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">head</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">+=</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
    <span class="n">name2seq</span><span class="p">[</span><span class="n">head</span><span class="p">]</span> <span class="o">=</span> <span class="n">seq</span>
    <span class="k">return</span> <span class="n">name2seq</span>



<span class="c1"># get information alignment</span>
<span class="n">name2seq</span> <span class="o">=</span> <span class="n">get_seqs</span><span class="p">(</span><span class="n">MSA</span><span class="p">)</span>


<span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">t</span><span class="p">:</span>
    <span class="n">leaf</span><span class="o">.</span><span class="n">add_prop</span><span class="p">(</span><span class="s1">&#39;seq&#39;</span><span class="p">,</span> <span class="n">name2seq</span><span class="p">[</span><span class="n">leaf</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">layout_alnface_gray</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">AlignmentFace</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seq&#39;</span><span class="p">),</span>
            <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">gap_format</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;#bcc3d0&#39;</span><span class="p">,</span> <span class="n">gapcolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">gap_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">layout_alnface_compact</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">AlignmentFace</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seq&#39;</span><span class="p">),</span>
            <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">gap_format</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s1">&#39;compactseq&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;#bcc3d0&#39;</span><span class="p">,</span> <span class="n">gapcolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">gap_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="k">def</span> <span class="nf">layout_seqface</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span><span class="p">:</span>

        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqFace</span><span class="p">(</span>
            <span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;seq&#39;</span><span class="p">),</span>
            <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">poswidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">draw_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">return</span>


<span class="n">layouts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;compact_aln&#39;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">layout_alnface_compact</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;gray_aln&#39;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">layout_alnface_gray</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">active</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>
    <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;seq&#39;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">layout_seqface</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>  <span class="n">active</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span>

<span class="p">]</span>

<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">,</span> <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/msa_layout.py">msa_layout.py example</a>.</p>
</section>
<section id="domain-annotation">
<h3><a class="toc-backref" href="#id41" role="doc-backlink">Domain annotation</a><a class="headerlink" href="#domain-annotation" title="Link to this heading">¶</a></h3>
<img alt="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/domain_layout.png?raw=true" src="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/domain_layout.png?raw=true" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">ete4</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">ete4.smartview</span> <span class="kn">import</span> <span class="n">TreeLayout</span><span class="p">,</span> <span class="n">SeqFace</span><span class="p">,</span> <span class="n">SeqMotifFace</span><span class="p">,</span> <span class="n">AlignmentFace</span>

<span class="c1"># Create a random tree and add to each leaf a random set of motifs</span>
<span class="c1"># from the original set</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="s2">&quot;((A, B, C, D, E, F, G), H, I);&quot;</span><span class="p">)</span>

<span class="n">seq</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;-----------------------------------------------AQAK---IKGSKKAIKVFSSA---&quot;</span>
      <span class="s2">&quot;APERLQEYGSIFTDA---GLQRRPRHRIQSK-------ALQEKLKDFPVCVSTKPEPEDDAEEGLGGLPSN&quot;</span>
      <span class="s2">&quot;ISSVSSLLLFNTTENLYKKYVFLDPLAG----THVMLGAETEEKLFDAPLSISKREQLEQQVPENYFYVPD&quot;</span>
      <span class="s2">&quot;LGQVPEIDVPSYLPDLPGIANDLMYIADLGPGIAPSAPGTIPELPTFHTEVAEPLKVGELGSGMGAGPGTP&quot;</span>
      <span class="s2">&quot;AHTPSSLDTPHFVFQTYKMGAPPLPPSTAAPVGQGARQDDSSSSASPSVQGAPREVVDPSGGWATLLESIR&quot;</span>
      <span class="s2">&quot;QAGGIGKAKLRSMKERKLEKQQQKEQEQVRATSQGGHL--MSDLFNKLVMRRKGISGKGPGAGDGPGGAFA&quot;</span>
      <span class="s2">&quot;RVSDSIPPLPPPQQPQAEDED----&quot;</span><span class="p">)</span>

<span class="n">mixed_motifs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># seq.start, seq.end, shape, width, height, fgcolor, bgcolor</span>
        <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:blue&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|long text clipped long text clipped&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">101</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;pink&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">155</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="s2">&quot;()&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:purple&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">160</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;yellow&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">191</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="s2">&quot;&lt;&gt;&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:orange&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">201</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;brown&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">351</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="s2">&quot;v&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:gold&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">370</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="s2">&quot;compactseq&quot;</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">simple_motifs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># seq.start, seq.end, shape, width, height, fgcolor, bgcolor</span>
        <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">60</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:blue&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|long text clipped long text clipped&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">120</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;pink&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="s2">&quot;()&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">,</span> <span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|hello&quot;</span><span class="p">],</span>
<span class="p">]</span>

<span class="n">box_motifs</span> <span class="o">=</span> <span class="p">[</span>
        <span class="c1"># seq.start, seq.end, shape, width, height, fgcolor, bgcolor</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span>  <span class="mi">5</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:blue&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|10&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:ref&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|10&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">45</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:orange&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|20&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:pink&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|20&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">70</span><span class="p">,</span> <span class="mi">85</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:green&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|20&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">90</span><span class="p">,</span> <span class="mi">105</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:brown&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|20&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="mi">110</span><span class="p">,</span> <span class="mi">125</span><span class="p">,</span> <span class="s2">&quot;[]&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;rgradient:yellow&quot;</span><span class="p">,</span> <span class="s2">&quot;arial|8|white|20&quot;</span><span class="p">],</span>
<span class="p">]</span>

<span class="k">def</span> <span class="nf">layout_domain</span><span class="p">(</span><span class="n">node</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gapcolor</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gap_format</span><span class="o">=</span><span class="s2">&quot;blank&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;()&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">motifs</span><span class="o">=</span><span class="n">simple_motifs</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">motifs</span><span class="o">=</span><span class="n">simple_motifs</span><span class="p">,</span> <span class="n">gap_format</span><span class="o">=</span><span class="s2">&quot;blank&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;G&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">motifs</span><span class="o">=</span><span class="n">mixed_motifs</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;H&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">motifs</span><span class="o">=</span><span class="n">box_motifs</span><span class="p">,</span> <span class="n">gap_format</span><span class="o">=</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">node</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;I&#39;</span><span class="p">:</span>
        <span class="n">seq_face</span> <span class="o">=</span> <span class="n">SeqMotifFace</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">60</span><span class="p">],</span> <span class="n">seq_format</span><span class="o">=</span><span class="s2">&quot;seq&quot;</span><span class="p">)</span>
        <span class="n">node</span><span class="o">.</span><span class="n">add_face</span><span class="p">(</span><span class="n">seq_face</span><span class="p">,</span> <span class="n">position</span><span class="o">=</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>
    <span class="k">return</span>

<span class="n">layouts</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">TreeLayout</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;layout_domain&#39;</span><span class="p">,</span> <span class="n">ns</span><span class="o">=</span><span class="n">layout_domain</span><span class="p">,</span> <span class="n">aligned_faces</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">]</span>
<span class="n">t</span><span class="o">.</span><span class="n">explore</span><span class="p">(</span><span class="n">layouts</span><span class="o">=</span><span class="n">layouts</span><span class="p">,</span> <span class="n">keep_server</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Source code can be found in in ETE4 here: <a class="reference external" href="https://github.com/dengzq1234/ete4_gallery/blob/master/smartview/domain_layout.py">domain_layout.py example</a>.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">ETE Toolkit</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Tutorial</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tutorial_trees.html">Working with the Tree structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_phylogeny.html">Phylogenetic trees</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Tree drawing and exploration (web)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_treeview.html">Tree drawing (Qt)</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_taxonomy.html">Taxonomy databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="tutorial_treematcher.html">Tree matcher</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faqs.html">Frequently Asked Questions</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Tutorial</a><ul>
      <li>Previous: <a href="tutorial_phylogeny.html" title="previous chapter">Phylogenetic trees</a></li>
      <li>Next: <a href="tutorial_treeview.html" title="next chapter">Tree drawing (Qt)</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2008 - 2023, The ETE Toolkit Team.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="../_sources/tutorial/tutorial_smartview.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>