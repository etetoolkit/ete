<!DOCTYPE html>

<html lang="en" data-content_root="../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ete4.smartview.renderer.faces &#8212; ETE Toolkit 4.0.0-beta documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=4f649999" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/alabaster.css?v=039e1c02" />
    <script src="../../../../_static/documentation_options.js?v=f03ed5e5"></script>
    <script src="../../../../_static/doctools.js?v=888ff710"></script>
    <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="icon" href="../../../../_static/favicon.ico"/>
    <link rel="author" title="About these documents" href="../../../../about.html" />
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for ete4.smartview.renderer.faces</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">base64</span>
<span class="kn">from</span> <span class="nn">collections.abc</span> <span class="kn">import</span> <span class="n">Iterable</span>
<span class="kn">import</span> <span class="nn">pathlib</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">pi</span>

<span class="kn">from</span> <span class="nn">..utils</span> <span class="kn">import</span> <span class="n">InvalidUsage</span><span class="p">,</span> <span class="n">get_random_string</span>
<span class="kn">from</span> <span class="nn">.draw_helpers</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="n">CHAR_HEIGHT</span> <span class="o">=</span> <span class="mf">1.4</span> <span class="c1"># char&#39;s height to width ratio</span>

<span class="n">ALLOWED_IMG_EXTENSIONS</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;png&quot;</span><span class="p">,</span> <span class="s2">&quot;svg&quot;</span><span class="p">,</span> <span class="s2">&quot;jpeg&quot;</span> <span class="p">]</span>

<span class="n">_aacolors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="s2">&quot;#C8C8C8&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;R&#39;</span><span class="p">:</span><span class="s2">&quot;#145AFF&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;N&#39;</span><span class="p">:</span><span class="s2">&quot;#00DCDC&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;D&#39;</span><span class="p">:</span><span class="s2">&quot;#E60A0A&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="s2">&quot;#E6E600&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;Q&#39;</span><span class="p">:</span><span class="s2">&quot;#00DCDC&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;E&#39;</span><span class="p">:</span><span class="s2">&quot;#E60A0A&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="s2">&quot;#EBEBEB&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;H&#39;</span><span class="p">:</span><span class="s2">&quot;#8282D2&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="s2">&quot;#0F820F&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;L&#39;</span><span class="p">:</span><span class="s2">&quot;#0F820F&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;K&#39;</span><span class="p">:</span><span class="s2">&quot;#145AFF&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;M&#39;</span><span class="p">:</span><span class="s2">&quot;#E6E600&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;F&#39;</span><span class="p">:</span><span class="s2">&quot;#3232AA&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;P&#39;</span><span class="p">:</span><span class="s2">&quot;#DC9682&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;S&#39;</span><span class="p">:</span><span class="s2">&quot;#FA9600&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="s2">&quot;#FA9600&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;W&#39;</span><span class="p">:</span><span class="s2">&quot;#B45AB4&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;Y&#39;</span><span class="p">:</span><span class="s2">&quot;#3232AA&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;V&#39;</span><span class="p">:</span><span class="s2">&quot;#0F820F&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span><span class="s2">&quot;#FF69B4&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;Z&#39;</span><span class="p">:</span><span class="s2">&quot;#FF69B4&quot;</span> <span class="p">,</span>
    <span class="s1">&#39;X&#39;</span><span class="p">:</span><span class="s2">&quot;#BEA06E&quot;</span><span class="p">,</span>
    <span class="s1">&#39;.&#39;</span><span class="p">:</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
    <span class="s1">&#39;-&#39;</span><span class="p">:</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
    <span class="p">}</span>

<span class="n">_ntcolors</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span><span class="s1">&#39;#A0A0FF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;G&#39;</span><span class="p">:</span><span class="s1">&#39;#FF7070&#39;</span><span class="p">,</span>
    <span class="s1">&#39;I&#39;</span><span class="p">:</span><span class="s1">&#39;#80FFFF&#39;</span><span class="p">,</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span><span class="s1">&#39;#FF8C4B&#39;</span><span class="p">,</span>
    <span class="s1">&#39;T&#39;</span><span class="p">:</span><span class="s1">&#39;#A0FFA0&#39;</span><span class="p">,</span>
    <span class="s1">&#39;U&#39;</span><span class="p">:</span><span class="s1">&#39;#FF8080&#39;</span><span class="p">,</span>
    <span class="s1">&#39;.&#39;</span><span class="p">:</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
    <span class="s1">&#39;-&#39;</span><span class="p">:</span><span class="s2">&quot;#FFFFFF&quot;</span><span class="p">,</span>
    <span class="s1">&#39; &#39;</span><span class="p">:</span><span class="s2">&quot;#FFFFFF&quot;</span>
    <span class="p">}</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;Face&#39;</span><span class="p">,</span> <span class="s1">&#39;TextFace&#39;</span><span class="p">,</span> <span class="s1">&#39;AttrFace&#39;</span><span class="p">,</span> <span class="s1">&#39;CircleFace&#39;</span><span class="p">,</span> <span class="s1">&#39;RectFace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;ArrowFace&#39;</span><span class="p">,</span> <span class="s1">&#39;SelectedFace&#39;</span><span class="p">,</span> <span class="s1">&#39;SelectedCircleFace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SelectedRectFace&#39;</span><span class="p">,</span> <span class="s1">&#39;OutlineFace&#39;</span><span class="p">,</span> <span class="s1">&#39;AlignLinkFace&#39;</span><span class="p">,</span> <span class="s1">&#39;SeqFace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;SeqMotifFace&#39;</span><span class="p">,</span> <span class="s1">&#39;AlignmentFace&#39;</span><span class="p">,</span> <span class="s1">&#39;ScaleFace&#39;</span><span class="p">,</span> <span class="s1">&#39;PieChartFace&#39;</span><span class="p">,</span>
    <span class="s1">&#39;HTMLFace&#39;</span><span class="p">,</span> <span class="s1">&#39;ImgFace&#39;</span><span class="p">,</span> <span class="s1">&#39;LegendFace&#39;</span><span class="p">,</span> <span class="s1">&#39;StackedBarFace&#39;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">clean_text</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[^A-Za-z0-9_-]&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>  <span class="n">text</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">swap_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_top&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;branch_bottom&#39;</span>
    <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_bottom&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;branch_top&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pos</span>


<span class="k">def</span> <span class="nf">stringify</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">content</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">content</span><span class="p">,</span> <span class="n">Iterable</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">content</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>


<div class="viewcode-block" id="Face">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face">[docs]</a>
<span class="k">class</span> <span class="nc">Face</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for faces.</span>

<span class="sd">    Ete uses &quot;faces&quot; to show some piece of information from</span>
<span class="sd">    a node in a tree (as text or graphics of many kinds).</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="Face.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">node</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="s2">&quot;Empty&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding_x</span> <span class="o">=</span> <span class="n">padding_x</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">padding_y</span> <span class="o">=</span> <span class="n">padding_y</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">always_drawn</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Use carefully to avoid overheading...</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="kc">False</span>  <span class="c1"># Stretch width independently of height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Aligned panel viewport (x1, x2)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">=</span> <span class="mi">100</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;Face&quot;</span>

<div class="viewcode-block" id="Face.in_aligned_viewport">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.in_aligned_viewport">[docs]</a>
    <span class="k">def</span> <span class="nf">in_aligned_viewport</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">segment</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">intersects_segment</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">,</span> <span class="n">segment</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="Face.get_content">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.get_content">[docs]</a>
    <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span></div>


<div class="viewcode-block" id="Face.get_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.get_box">[docs]</a>
    <span class="k">def</span> <span class="nf">get_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="Face.compute_fsize">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.compute_fsize">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_fsize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">*</span> <span class="n">CHAR_HEIGHT</span><span class="p">,</span> <span class="nb">abs</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span><span class="p">),</span> <span class="n">max_fsize</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">])</span></div>


<div class="viewcode-block" id="Face.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_content</span><span class="p">()</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">size</span>

        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">za</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">zoom</span>
        <span class="k">if</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;aligned&quot;</span><span class="p">):</span>
            <span class="n">zx</span> <span class="o">=</span> <span class="n">za</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="p">(</span><span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_top&#39;</span><span class="p">:</span>  <span class="c1"># above the branch</span>
            <span class="n">avail_dx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">n_col</span>
            <span class="n">avail_dy</span> <span class="o">=</span> <span class="n">bdy</span> <span class="o">/</span> <span class="n">n_row</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx_before</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">bdy</span> <span class="o">-</span> <span class="n">avail_dy</span> <span class="o">-</span> <span class="n">dy_before</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_bottom&#39;</span><span class="p">:</span>  <span class="c1"># below the branch</span>
            <span class="n">avail_dx</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="n">n_col</span>
            <span class="n">avail_dy</span> <span class="o">=</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">bdy</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_row</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">dx_before</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">bdy</span> <span class="o">+</span> <span class="n">dy_before</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_right&#39;</span><span class="p">:</span>  <span class="c1"># right of node</span>
            <span class="n">avail_dx</span> <span class="o">=</span> <span class="n">dx_to_closest_child</span> <span class="o">/</span> <span class="n">n_col</span>\
                    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">is_collapsed</span><span class="p">)</span>\
                    <span class="k">else</span> <span class="kc">None</span>
            <span class="n">avail_dy</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">bdy</span><span class="p">,</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">bdy</span><span class="p">,</span> <span class="n">bdy</span> <span class="o">-</span> <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span> <span class="o">-</span> <span class="n">bdy</span><span class="p">])</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">n_row</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">bdx</span> <span class="o">+</span> <span class="n">dx_before</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">bdy</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="n">n_row</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">avail_dy</span>

        <span class="k">elif</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;aligned&#39;</span><span class="p">):</span> <span class="c1"># right of tree</span>
            <span class="n">avail_dx</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># should be overriden</span>
            <span class="n">avail_dy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">/</span> <span class="n">n_row</span>
            <span class="n">aligned_x</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">node_size</span><span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">tree</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>\
                    <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">panel</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">drawer</span><span class="o">.</span><span class="n">xmin</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">aligned_x</span> <span class="o">+</span> <span class="n">dx_before</span>

            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_bottom&#39;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">avail_dy</span> <span class="o">-</span> <span class="n">dy_before</span>
            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_top&#39;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy_before</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">row</span> <span class="o">-</span> <span class="n">n_row</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">avail_dy</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;unkown position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">padding_x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_x</span> <span class="o">/</span> <span class="n">zx</span>
        <span class="n">padding_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span>
            <span class="n">x</span> <span class="o">+</span> <span class="n">padding_x</span><span class="p">,</span>
            <span class="n">y</span> <span class="o">+</span> <span class="n">padding_y</span><span class="p">,</span>
            <span class="c1"># avail_dx may not be initialized for branch_right and aligned</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">avail_dx</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">padding_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">if</span> <span class="n">avail_dx</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">avail_dy</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">padding_y</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="Face.fits">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.Face.fits">[docs]</a>
    <span class="k">def</span> <span class="nf">fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return True if Face fits in computed box.</span>
<span class="sd">        Method overriden by inheriting classes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">_check_own_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Content** has not been computed yet.&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_check_own_variables</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;**Box** has not been computed yet.</span><span class="se">\</span>
<span class="s1">                    </span><span class="se">\n</span><span class="s1">Please run `compute_bounding_box()` first&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_content</span><span class="p">()</span>
        <span class="k">return</span></div>



<div class="viewcode-block" id="TextFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.TextFace">[docs]</a>
<span class="k">class</span> <span class="nc">TextFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>

<div class="viewcode-block" id="TextFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.TextFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="c1"># NOTE: if width is passed as an argument, then it is not</span>
        <span class="c1"># computed from fit_fontsize() (this is part of a temporary</span>
        <span class="c1"># hack to make LayoutBarPlot work).</span>

        <span class="c1"># FIXME: The rotation is not being taken into account when</span>
        <span class="c1"># computing the bounding box.</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="n">stringify</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="n">min_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotation</span> <span class="o">=</span> <span class="n">rotation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;TextFace&quot;</span>

<div class="viewcode-block" id="TextFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.TextFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">swap_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="k">def</span> <span class="nf">fit_fontsize</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">):</span>
            <span class="n">dchar</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">dchar</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
            <span class="n">dxchar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zx</span> <span class="o">*</span> <span class="n">CHAR_HEIGHT</span><span class="p">)</span>
            <span class="n">dychar</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">dxchar</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">dychar</span>

        <span class="c1"># FIXME: Temporary hack to make the headers of LayoutBarPlot work.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">fit_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">fit_fontsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>


        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_top&#39;</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="c1"># container bottom</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_bottom&#39;</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="c1"># container top</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_bottom&#39;</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_top&#39;</span><span class="p">:</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># branch_right and aligned</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="o">*</span><span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="TextFace.fits">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.TextFace.fits">[docs]</a>
    <span class="k">def</span> <span class="nf">fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">!=</span> <span class="s2">&quot;None&quot;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span></div>


<div class="viewcode-block" id="TextFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.TextFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
                <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span><span class="p">,</span>
                <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span> <span class="c1"># default sans-serif</span>
                <span class="p">}</span>
        <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_content</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">rotation</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="AttrFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AttrFace">[docs]</a>
<span class="k">class</span> <span class="nc">AttrFace</span><span class="p">(</span><span class="n">TextFace</span><span class="p">):</span>

<div class="viewcode-block" id="AttrFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AttrFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">ftype</span><span class="o">=</span><span class="s2">&quot;sans-serif&quot;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">TextFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span>
                <span class="n">min_fsize</span><span class="o">=</span><span class="n">min_fsize</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="n">max_fsize</span><span class="p">,</span>
                <span class="n">ftype</span><span class="o">=</span><span class="n">ftype</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span> <span class="o">=</span> <span class="n">attr</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;AttrFace&quot;</span>

    <span class="k">def</span> <span class="nf">_check_own_node</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;An associated **node** must be provided to compute **content**.&#39;</span><span class="p">)</span>

<div class="viewcode-block" id="AttrFace.get_content">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AttrFace.get_content">[docs]</a>
    <span class="k">def</span> <span class="nf">get_content</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>\
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">props</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_attr</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">%</span> <span class="n">content</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="k">else</span> <span class="n">content</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_content</span></div>
</div>



<div class="viewcode-block" id="CircleFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.CircleFace">[docs]</a>
<span class="k">class</span> <span class="nc">CircleFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>

<div class="viewcode-block" id="CircleFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.CircleFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="c1"># Drawing private properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="n">tooltip</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;CircleFace&quot;</span>

<div class="viewcode-block" id="CircleFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.CircleFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">swap_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_x</span> <span class="o">/</span> <span class="n">zx</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">padding_y</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="n">max_dy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span>
        <span class="n">max_diameter</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span><span class="p">,</span> <span class="n">max_dy</span><span class="p">)</span> <span class="k">if</span> <span class="n">dx</span> <span class="o">!=</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">max_dy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">max_diameter</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

        <span class="n">cx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="n">zx</span> <span class="o">-</span> <span class="n">padding_x</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_top&#39;</span><span class="p">:</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="c1"># container bottom</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_bottom&#39;</span><span class="p">:</span>
            <span class="n">cy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="c1"># container top</span>

        <span class="k">else</span><span class="p">:</span> <span class="c1"># branch_right and aligned</span>
            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">radius</span><span class="p">)</span>

            <span class="n">cx</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="n">zx</span> <span class="o">-</span> <span class="n">padding_x</span> <span class="c1"># centered</span>

            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_bottom&#39;</span><span class="p">:</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="n">zy</span>

            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_top&#39;</span><span class="p">:</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="n">zy</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="n">cy</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="c1"># centered</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span> <span class="o">=</span> <span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="n">cy</span><span class="p">,</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">/</span> <span class="n">zx</span> <span class="o">-</span> <span class="n">padding_x</span><span class="p">),</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">-</span> <span class="n">padding_y</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="CircleFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.CircleFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">}</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="k">else</span> <span class="p">{}</span>
        <span class="k">yield</span> <span class="n">draw_circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="RectFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.RectFace">[docs]</a>
<span class="k">class</span> <span class="nc">RectFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="RectFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.RectFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># text color</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">stroke_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span>
        <span class="c1"># Text related</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">text</span><span class="p">)</span> <span class="k">if</span> <span class="n">text</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rotate_text</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="n">fgcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="n">min_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span> <span class="o">=</span> <span class="n">stroke_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span> <span class="o">=</span> <span class="n">tooltip</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;RectFace&quot;</span>

<div class="viewcode-block" id="RectFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.RectFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">swap_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>
        <span class="n">zx</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span>\
                <span class="ow">and</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;aligned&#39;</span><span class="p">)</span>\
                <span class="ow">and</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">!=</span> <span class="s1">&#39;circ&#39;</span>\
                <span class="k">else</span> <span class="n">zx</span>

        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>

        <span class="k">def</span> <span class="nf">get_dimensions</span><span class="p">(</span><span class="n">max_width</span><span class="p">,</span> <span class="n">max_height</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">max_width</span> <span class="ow">or</span> <span class="n">max_height</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">max_width</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_width</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span>\
               <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">max_height</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span> <span class="ow">and</span> <span class="n">max_height</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">):</span>
                <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>

            <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">zx</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">height</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">/</span> <span class="n">zy</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span>

            <span class="k">if</span> <span class="n">width</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">max_width</span> <span class="ow">or</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">height</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">),</span> <span class="n">max_height</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="nb">min</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">max_width</span> <span class="ow">or</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">)),</span> <span class="n">max_height</span>

            <span class="n">hw_ratio</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">width</span>

            <span class="k">if</span> <span class="n">max_width</span> <span class="ow">and</span> <span class="n">width</span> <span class="o">&gt;</span> <span class="n">max_width</span><span class="p">:</span>
                <span class="n">width</span> <span class="o">=</span> <span class="n">max_width</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">width</span> <span class="o">*</span> <span class="n">hw_ratio</span>
            <span class="k">if</span> <span class="n">max_height</span> <span class="ow">and</span> <span class="n">height</span> <span class="o">&gt;</span> <span class="n">max_height</span><span class="p">:</span>
                <span class="n">height</span> <span class="o">=</span> <span class="n">max_height</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="ow">or</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
                    <span class="n">width</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="n">hw_ratio</span>

            <span class="n">height</span> <span class="o">/=</span> <span class="n">r</span>  <span class="c1"># in circular drawer</span>
            <span class="k">return</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>

        <span class="n">max_dy</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">r</span>  <span class="c1"># take into account circular mode</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_top&#39;</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">max_dy</span><span class="p">)</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="c1"># container bottom</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_bottom&#39;</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">max_dy</span><span class="p">)</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span> <span class="c1"># container top</span>

        <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_right&#39;</span><span class="p">:</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="n">dx</span><span class="p">,</span> <span class="n">max_dy</span><span class="p">)</span>
            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;aligned&#39;</span><span class="p">):</span>
            <span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="n">get_dimensions</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="c1"># height = min(dy, (self.height - 2 * self.padding_y) / zy)</span>
            <span class="c1"># width = min(self.width - 2 * self.padding_x) / zx</span>

            <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_bottom&#39;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">height</span>
            <span class="k">elif</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;aligned_top&#39;</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">height</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>

            <span class="n">box</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="o">*</span><span class="n">box</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="RectFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.RectFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>

        <span class="n">circ_drawer</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
            <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
            <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span><span class="p">,</span>
            <span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">circ_drawer</span><span class="p">:</span>
            <span class="n">rect_id</span> <span class="o">=</span> <span class="n">get_random_string</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">style</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect_id</span>

        <span class="k">yield</span> <span class="n">draw_rect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
            <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">circ_drawer</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_text</span><span class="p">:</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">zx</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">,</span>
                                   <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">/</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>

                <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">zx</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
                <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">text_style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span><span class="p">,</span>
                <span class="s1">&#39;text_anchor&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span> <span class="c1"># default sans-serif</span>
                <span class="p">}</span>

            <span class="k">if</span> <span class="n">circ_drawer</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="c1"># Turn text upside down on bottom</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span>
                <span class="n">text_style</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>

            <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">text_box</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rect_id</span><span class="p">))</span> <span class="k">if</span> <span class="n">circ_drawer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ArrowFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ArrowFace">[docs]</a>
<span class="k">class</span> <span class="nc">ArrowFace</span><span class="p">(</span><span class="n">RectFace</span><span class="p">):</span>
<div class="viewcode-block" id="ArrowFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ArrowFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">stroke_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="s1">&#39;1.5px&#39;</span><span class="p">,</span>
            <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="c1"># text color</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">RectFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span> <span class="n">fgcolor</span><span class="o">=</span><span class="n">fgcolor</span><span class="p">,</span>
                <span class="n">min_fsize</span><span class="o">=</span><span class="n">min_fsize</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="n">max_fsize</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="n">ftype</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span> <span class="o">=</span> <span class="n">orientation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span> <span class="o">=</span> <span class="n">stroke_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ArrowFace&quot;</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span>
    <span class="nd">@orientation</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;left&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="s1">&#39;Wrong ArrowFace orientation </span><span class="si">{value}</span><span class="s1">. Set value to &quot;right&quot; or &quot;left&quot;&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_orientation</span> <span class="o">=</span> <span class="n">value</span>

<div class="viewcode-block" id="ArrowFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ArrowFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>

        <span class="n">circ_drawer</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span>
            <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="mf">0.7</span><span class="p">,</span>
            <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span><span class="p">,</span>
            <span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span> <span class="ow">and</span> <span class="n">circ_drawer</span><span class="p">:</span>
            <span class="n">rect_id</span> <span class="o">=</span> <span class="n">get_random_string</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
            <span class="n">style</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rect_id</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">tip</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">*</span> <span class="mf">0.9</span><span class="p">)</span> <span class="o">/</span> <span class="n">zx</span>
        <span class="k">yield</span> <span class="n">draw_arrow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">,</span>
                <span class="n">tip</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">orientation</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span>
                <span class="n">tooltip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">circ_drawer</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rotate_text</span><span class="p">:</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="mi">90</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> <span class="o">*</span> <span class="n">zx</span><span class="p">)</span> <span class="o">*</span> <span class="n">r</span><span class="p">,</span>
                                   <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">/</span> <span class="n">zy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>

                <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="n">dx</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">zx</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rotation</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">dx</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">),</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
                <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
            <span class="n">text_style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span><span class="p">,</span>
                <span class="s1">&#39;text_anchor&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span> <span class="c1"># default sans-serif</span>
                <span class="s1">&#39;pointer-events&#39;</span><span class="p">:</span> <span class="s1">&#39;none&#39;</span><span class="p">,</span>
                <span class="p">}</span>

            <span class="k">if</span> <span class="n">circ_drawer</span><span class="p">:</span>
                <span class="n">offset</span> <span class="o">=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="c1"># Turn text upside down on bottom</span>
                <span class="k">if</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">offset</span> <span class="o">+=</span> <span class="n">dx</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span>
                <span class="n">text_style</span><span class="p">[</span><span class="s1">&#39;offset&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offset</span>

            <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">text_box</span><span class="p">,</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">,</span>
                    <span class="n">rotation</span><span class="o">=</span><span class="n">rotation</span><span class="p">,</span>
                    <span class="n">anchor</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;#&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rect_id</span><span class="p">))</span> <span class="k">if</span> <span class="n">circ_drawer</span> <span class="k">else</span> <span class="kc">None</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span></div>
</div>




<span class="c1"># Selected faces</span>
<div class="viewcode-block" id="SelectedFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedFace">[docs]</a>
<span class="k">class</span> <span class="nc">SelectedFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="SelectedFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">clean_text</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;selected_results_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SelectedFace&quot;</span></div>


<div class="viewcode-block" id="SelectedCircleFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedCircleFace">[docs]</a>
<span class="k">class</span> <span class="nc">SelectedCircleFace</span><span class="p">(</span><span class="n">SelectedFace</span><span class="p">,</span> <span class="n">CircleFace</span><span class="p">):</span>
<div class="viewcode-block" id="SelectedCircleFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedCircleFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">SelectedFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

        <span class="n">CircleFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SelectedCircleFace&quot;</span></div>


<div class="viewcode-block" id="SelectedRectFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedRectFace">[docs]</a>
<span class="k">class</span> <span class="nc">SelectedRectFace</span><span class="p">(</span><span class="n">SelectedFace</span><span class="p">,</span> <span class="n">RectFace</span><span class="p">):</span>
<div class="viewcode-block" id="SelectedRectFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SelectedRectFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">text</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">SelectedFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>

        <span class="n">RectFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="n">text</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SelectedRectFace&quot;</span></div>



<div class="viewcode-block" id="OutlineFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace">[docs]</a>
<span class="k">class</span> <span class="nc">OutlineFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="OutlineFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">stroke_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span>
            <span class="n">collapsing_height</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="c1"># height in px at which outline becomes a line</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collapsing_height</span> <span class="o">=</span> <span class="n">collapsing_height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">always_drawn</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;OutlineFace&quot;</span>

<div class="viewcode-block" id="OutlineFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">outline</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">outline</span> \
            <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="k">else</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">zoom</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">drawer</span><span class="o">.</span><span class="n">zoom</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
            <span class="n">r</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">da</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span>
            <span class="n">a1</span><span class="p">,</span> <span class="n">a2</span> <span class="o">=</span> <span class="n">clip_angles</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="n">da</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">dr</span><span class="p">,</span> <span class="n">a2</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_box</span><span class="p">()</span></div>


<div class="viewcode-block" id="OutlineFace.get_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace.get_box">[docs]</a>
    <span class="k">def</span> <span class="nf">get_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span>
            <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span></div>


<div class="viewcode-block" id="OutlineFace.fits">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace.fits">[docs]</a>
    <span class="k">def</span> <span class="nf">fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="OutlineFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.OutlineFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="n">nodestyle</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">sm_style</span>
        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="n">nodestyle</span><span class="p">[</span><span class="s2">&quot;outline_line_color&quot;</span><span class="p">],</span>
                <span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="n">nodestyle</span><span class="p">[</span><span class="s2">&quot;outline_line_width&quot;</span><span class="p">],</span>
                <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="n">nodestyle</span><span class="p">[</span><span class="s2">&quot;outline_color&quot;</span><span class="p">],</span>
                <span class="s1">&#39;fill-opacity&#39;</span><span class="p">:</span> <span class="n">nodestyle</span><span class="p">[</span><span class="s2">&quot;outline_opacity&quot;</span><span class="p">],</span>
                <span class="p">}</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">outline</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>
        <span class="n">circ_drawer</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span>
        <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">circ_drawer</span> <span class="k">else</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">collapsing_height</span><span class="p">:</span>
            <span class="c1"># Convert to line if height less than one pixel</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">circ_drawer</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">yield</span> <span class="n">draw_outline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">outline</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="AlignLinkFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace">[docs]</a>
<span class="k">class</span> <span class="nc">AlignLinkFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="AlignLinkFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">stroke_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">stroke_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
            <span class="n">line_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Line types: 0 solid, 1 dotted, 2 dashed&quot;&quot;&quot;</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span> <span class="o">=</span> <span class="n">stroke_color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span> <span class="o">=</span> <span class="n">stroke_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type</span> <span class="o">=</span> <span class="n">line_type</span><span class="p">;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span> <span class="o">=</span> <span class="n">opacity</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">always_drawn</span> <span class="o">=</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;AlignLinkFace&quot;</span>

<div class="viewcode-block" id="AlignLinkFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">NPANELS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span> <span class="ow">and</span> <span class="n">pos</span> <span class="o">==</span> <span class="s1">&#39;branch_right&#39;</span><span class="p">:</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">point</span>
            <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">size</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">bdx</span> <span class="o">+</span> <span class="n">dx_before</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span><span class="p">:</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aligned</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">tree_style</span><span class="o">.</span><span class="n">aligned_grid_dxs</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
                <span class="c1"># p2 = (drawer.node_size(drawer.tree)[0], y + dy/2)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">aligned</span><span class="p">):</span>
                    <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">aligned</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">bdx</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">p1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">p2</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                    <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Should not take space</span></div>


<div class="viewcode-block" id="AlignLinkFace.get_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace.get_box">[docs]</a>
    <span class="k">def</span> <span class="nf">get_box</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Box</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="c1"># Should not take space</span></div>


<div class="viewcode-block" id="AlignLinkFace.fits">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace.fits">[docs]</a>
    <span class="k">def</span> <span class="nf">fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="AlignLinkFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignLinkFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">NPANELS</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_color</span><span class="p">,</span>
                <span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">stroke_width</span><span class="p">,</span>
                <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">,</span>
                <span class="p">}</span>
        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">panel</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span> <span class="ow">and</span>\
          <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">is_leaf</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">node</span><span class="o">.</span><span class="n">is_collapsed</span><span class="p">)</span>\
          <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span><span class="p">:</span>
            <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">line</span>
            <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="s1">&#39;align-link&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="SeqFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqFace">[docs]</a>
<span class="k">class</span> <span class="nc">SeqFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="SeqFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span> <span class="n">poswidth</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="n">draw_text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">=</span> <span class="n">seqtype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">colors</span> <span class="o">=</span> <span class="n">_aacolors</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">==</span> <span class="s1">&#39;aa&#39;</span> <span class="k">else</span> <span class="n">_ntcolors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">=</span> <span class="n">poswidth</span>  <span class="c1"># width of each nucleotide/aa</span>

        <span class="c1"># Text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">draw_text</span> <span class="o">=</span> <span class="n">draw_text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="kc">None</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SeqFace&quot;</span>

<div class="viewcode-block" id="SeqFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="s1">&#39;branch_right&#39;</span><span class="p">,</span> <span class="s1">&#39;aligned&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> not allowed for SeqFace&#39;</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span> <span class="o">/</span> <span class="n">zx</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_text</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">/</span> <span class="n">zx</span><span class="p">,</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="SeqFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">/</span> <span class="n">zx</span>
        <span class="c1"># Send sequences as a whole to be rendered by PIXIjs</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">draw_text</span><span class="p">:</span>
            <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;notext&quot;</span>

        <span class="k">yield</span> <span class="p">[</span> <span class="sa">f</span><span class="s1">&#39;pixi-aa_</span><span class="si">{</span><span class="n">aa_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">Box</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">),</span> <span class="n">dy</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="p">]</span></div>
</div>


        <span class="c1"># Rende text if necessary</span>
        <span class="c1"># if self.draw_text:</span>
            <span class="c1"># text_style = {</span>
                <span class="c1"># &#39;max_fsize&#39;: self._fsize,</span>
                <span class="c1"># &#39;text_anchor&#39;: &#39;middle&#39;,</span>
                <span class="c1"># &#39;ftype&#39;: f&#39;{self.ftype}, sans-serif&#39;, # default sans-serif</span>
                <span class="c1"># }</span>
            <span class="c1"># for idx, pos in enumerate(self.seq):</span>
                <span class="c1"># x = x0 + idx * dx</span>
                <span class="c1"># r = (x or 1e-10) if drawer.TYPE == &#39;circ&#39; else 1</span>
                <span class="c1"># # Draw rect</span>
                <span class="c1"># if pos != &#39;-&#39;:</span>
                    <span class="c1"># text_box = Box(x + dx / 2,</span>
                            <span class="c1"># y + (dy - self._fsize / (zy * r)) / 2,</span>
                            <span class="c1"># dx, dy)</span>
                    <span class="c1"># yield draw_text(text_box,</span>
                            <span class="c1"># pos,</span>
                            <span class="c1"># style=text_style)</span>


<div class="viewcode-block" id="SeqMotifFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace">[docs]</a>
<span class="k">class</span> <span class="nc">SeqMotifFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="SeqMotifFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">motifs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span>
            <span class="n">gap_format</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># max height</span>
            <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;#bcc3d0&#39;</span><span class="p">,</span> <span class="n">gapcolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">gap_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">motifs</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">seq</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;At least one argument (seq or motifs) should be provided.&quot;</span><span class="p">)</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span> <span class="ow">or</span> <span class="s1">&#39;-&#39;</span> <span class="o">*</span> <span class="nb">max</span><span class="p">([</span><span class="n">m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">motifs</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">=</span> <span class="n">seqtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autoformat</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># block if 1px contains &gt; 1 tile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">motifs</span> <span class="o">=</span> <span class="n">motifs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overlaping_motif_opacity</span> <span class="o">=</span> <span class="mf">0.5</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">=</span> <span class="n">seq_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span> <span class="o">=</span> <span class="n">gap_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gap_linewidth</span> <span class="o">=</span> <span class="n">gap_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compress_gaps</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>    <span class="c1"># sum of all regions&#39; width if not provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>  <span class="c1"># dynamically computed if not provided</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">fg</span> <span class="o">=</span> <span class="s1">&#39;#000&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bg</span> <span class="o">=</span> <span class="n">_aacolors</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">==</span> <span class="s1">&#39;aa&#39;</span> <span class="k">else</span> <span class="n">_ntcolors</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span> <span class="o">=</span> <span class="n">fgcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span> <span class="o">=</span> <span class="n">bgcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span> <span class="o">=</span> <span class="n">gapcolor</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;^&#39;</span><span class="p">:</span> <span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="s1">&#39;&gt;&#39;</span><span class="p">:</span> <span class="s1">&#39;right&#39;</span><span class="p">,</span> <span class="s1">&#39;v&#39;</span><span class="p">:</span> <span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="s1">&#39;&lt;&#39;</span><span class="p">:</span> <span class="s1">&#39;left&#39;</span><span class="p">}</span>

        <span class="c1"># Text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_fsize</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_regions</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;SeqMotifFace&quot;</span>

<div class="viewcode-block" id="SeqMotifFace.build_regions">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace.build_regions">[docs]</a>
    <span class="k">def</span> <span class="nf">build_regions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Build and sort sequence regions: seq representation and motifs&quot;&quot;&quot;</span>
        <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span>
        <span class="n">motifs</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">motifs</span><span class="p">)</span>

        <span class="c1"># if only sequence is provided, build regions out of gap spaces</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">motifs</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">==</span> <span class="s2">&quot;seq&quot;</span><span class="p">:</span>
                <span class="n">motifs</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="s2">&quot;seq&quot;</span><span class="p">,</span>
                    <span class="mi">15</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">motifs</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([^-]+)&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">):</span>
                    <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">reg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                            <span class="n">motifs</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                        <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>

        <span class="n">motifs</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="c1"># complete missing regions</span>
        <span class="n">current_seq_pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">mf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">motifs</span><span class="p">):</span>
            <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="n">mf</span>
            <span class="k">if</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="n">current_seq_pos</span><span class="p">:</span>
                <span class="n">pos</span> <span class="o">=</span> <span class="n">current_seq_pos</span>
                <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([^-]+)&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="n">current_seq_pos</span><span class="p">:</span><span class="n">start</span><span class="p">]):</span>
                    <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">reg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">!=</span> <span class="s2">&quot;seq&quot;</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                <span class="s2">&quot;gap_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>
                <span class="n">current_seq_pos</span> <span class="o">=</span> <span class="n">start</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mf</span><span class="p">)</span>
            <span class="n">current_seq_pos</span> <span class="o">=</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">current_seq_pos</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">current_seq_pos</span>
            <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([^-]+)&#39;</span><span class="p">,</span> <span class="n">seq</span><span class="p">[</span><span class="n">current_seq_pos</span><span class="p">:]):</span>
                <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">reg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">!=</span> <span class="s2">&quot;seq&quot;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                            <span class="s2">&quot;gap_&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">fgcolor</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">bgcolor</span><span class="p">,</span> <span class="kc">None</span><span class="p">])</span>
                    <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>

        <span class="c1"># Compute total width and</span>
        <span class="c1"># Detect overlapping, reducing opacity in overlapping elements</span>
        <span class="n">total_width</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">prev_end</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">):</span>
            <span class="n">overlapping</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">prev_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;gap_&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_gaps</span> <span class="k">else</span> <span class="n">w</span>
            <span class="n">total_width</span> <span class="o">+=</span> <span class="p">(</span><span class="n">w</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span> <span class="o">-</span> <span class="n">overlapping</span><span class="p">)</span>
            <span class="n">prev_end</span> <span class="o">=</span> <span class="n">end</span>
            <span class="n">opacity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overlaping_motif_opacity</span> <span class="k">if</span> <span class="n">overlapping</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">opacity</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">overlapping</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">[</span><span class="n">idx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">opacity</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">total_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">total_width</span></div>


<div class="viewcode-block" id="SeqMotifFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="s1">&#39;branch_right&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;aligned&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> not allowed for SeqMotifFace&#39;</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="o">=</span> <span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">zx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="SeqMotifFace.fits">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace.fits">[docs]</a>
    <span class="k">def</span> <span class="nf">fits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="kc">True</span></div>


<div class="viewcode-block" id="SeqMotifFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.SeqMotifFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="c1"># Only leaf/collapsed branch_right or aligned</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">):</span>
            <span class="n">vx0</span><span class="p">,</span> <span class="n">vx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span>
            <span class="n">too_small</span> <span class="o">=</span> <span class="p">((</span><span class="n">vx1</span> <span class="o">-</span> <span class="n">vx0</span><span class="p">)</span> <span class="o">*</span> <span class="n">zx</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span> <span class="o">/</span> <span class="n">zx</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="ow">in</span> <span class="p">[</span> <span class="s2">&quot;seq&quot;</span><span class="p">,</span> <span class="s2">&quot;compactseq&quot;</span> <span class="p">]</span> <span class="ow">and</span> <span class="n">too_small</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">=</span> <span class="s2">&quot;[]&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_regions</span><span class="p">()</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">==</span> <span class="s2">&quot;[]&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">too_small</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">=</span> <span class="s2">&quot;seq&quot;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">regions</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">build_regions</span><span class="p">()</span>


        <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="n">prev_end</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_linewidth</span><span class="p">,</span>
                                           <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span><span class="p">})</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">regions</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
                <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">shape</span><span class="p">,</span> <span class="n">posw</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">opacity</span> <span class="o">=</span> <span class="n">item</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># if not self.in_aligned_viewport((start / zx, end / zx)):</span>
                <span class="c1"># continue</span>

            <span class="n">posw</span> <span class="o">=</span> <span class="p">(</span><span class="n">posw</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span>
            <span class="n">w</span> <span class="o">=</span> <span class="n">posw</span> <span class="o">*</span> <span class="p">(</span><span class="n">end</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span>
            <span class="n">style</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="n">bg</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="n">opacity</span> <span class="p">}</span>

            <span class="c1"># Overlapping</span>
            <span class="n">overlapping</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">prev_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">overlapping</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">-=</span> <span class="n">posw</span> <span class="o">*</span> <span class="n">overlapping</span>
            <span class="n">prev_end</span> <span class="o">=</span> <span class="n">end</span>

            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">default_h</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">h</span> <span class="ow">or</span> <span class="n">default_h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="ow">or</span> <span class="n">default_h</span><span class="p">,</span> <span class="n">default_h</span><span class="p">])</span> <span class="o">/</span> <span class="n">zy</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">shape</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;gap_&quot;</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">compress_gaps</span><span class="p">:</span>
                    <span class="n">w</span> <span class="o">=</span> <span class="n">posw</span>
                <span class="n">x</span> <span class="o">+=</span> <span class="n">w</span>
                <span class="k">continue</span>

            <span class="c1"># Line</span>
            <span class="k">if</span> <span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="s1">&#39;-&#39;</span><span class="p">]:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
                    <span class="n">p1</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                    <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span> <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="n">fg</span><span class="p">})</span>

            <span class="c1"># Rectangle</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;[]&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="p">[</span> <span class="s2">&quot;pixi-block&quot;</span><span class="p">,</span> <span class="n">box</span> <span class="p">]</span>

            <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;()&#39;</span><span class="p">:</span>
                <span class="n">style</span><span class="p">[</span><span class="s1">&#39;rounded&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                <span class="k">yield</span> <span class="n">draw_rect</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

            <span class="c1"># Rhombus</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;&lt;&gt;&#39;</span><span class="p">:</span>
                <span class="k">yield</span> <span class="n">draw_rhombus</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

            <span class="c1"># Triangle</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">h</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
                <span class="k">yield</span> <span class="n">draw_triangle</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">triangles</span><span class="p">[</span><span class="n">shape</span><span class="p">],</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

            <span class="c1"># Circle/ellipse</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;o&#39;</span><span class="p">:</span>
                <span class="n">center</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
                <span class="n">rx</span> <span class="o">=</span> <span class="n">w</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="n">ry</span> <span class="o">=</span> <span class="n">h</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">/</span> <span class="mi">2</span>
                <span class="k">if</span> <span class="n">rx</span> <span class="o">==</span> <span class="n">ry</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">draw_circle</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">yield</span> <span class="n">draw_ellipse</span><span class="p">(</span><span class="n">center</span><span class="p">,</span> <span class="n">rx</span><span class="p">,</span> <span class="n">ry</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">)</span>

            <span class="c1"># Sequence and compact sequence</span>
            <span class="k">elif</span> <span class="n">shape</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;seq&#39;</span><span class="p">,</span> <span class="s1">&#39;compactseq&#39;</span><span class="p">]:</span>
                <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">start</span> <span class="p">:</span> <span class="n">end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">:</span>
                    <span class="n">sx</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sw</span><span class="p">,</span> <span class="n">sh</span> <span class="o">=</span> <span class="n">box</span>
                    <span class="n">sposw</span> <span class="o">=</span> <span class="n">sw</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
                    <span class="n">viewport_start</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">/</span> <span class="n">zx</span>
                    <span class="n">viewport_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">/</span> <span class="n">zx</span>
                    <span class="n">sm_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">viewport_start</span> <span class="o">-</span> <span class="n">sx</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
                    <span class="n">sm_start</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sm_x</span> <span class="o">/</span> <span class="n">sposw</span><span class="p">)</span>
                    <span class="n">sm_end</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sx</span> <span class="o">+</span> <span class="n">sw</span> <span class="o">-</span> <span class="n">viewport_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">sposw</span><span class="p">)</span>
                    <span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span><span class="p">[</span><span class="n">sm_start</span><span class="p">:</span><span class="n">sm_end</span><span class="p">]</span>
                    <span class="n">sm_box</span> <span class="o">=</span> <span class="p">(</span><span class="n">sm_x</span><span class="p">,</span> <span class="n">sy</span><span class="p">,</span> <span class="n">sposw</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">sh</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">shape</span> <span class="o">==</span> <span class="s1">&#39;compactseq&#39;</span> <span class="ow">or</span> <span class="n">posw</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_fsize</span><span class="p">:</span>
                    <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;notext&quot;</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
                <span class="k">yield</span> <span class="p">[</span> <span class="sa">f</span><span class="s1">&#39;pixi-aa_</span><span class="si">{</span><span class="n">aa_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">sm_box</span><span class="p">,</span> <span class="n">seq</span> <span class="p">]</span>


            <span class="c1"># Text on top of shape</span>
            <span class="k">if</span> <span class="n">text</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">ftype</span><span class="p">,</span> <span class="n">fsize</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;|&quot;</span><span class="p">)</span>
                    <span class="n">fsize</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">fsize</span><span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="n">ftype</span><span class="p">,</span> <span class="n">fsize</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">,</span> <span class="p">(</span><span class="n">fg</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">fcolor</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">w</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">h</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">,</span> <span class="n">fsize</span><span class="p">)</span>
                <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">w</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zy</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="p">(</span><span class="n">zx</span> <span class="o">*</span> <span class="n">CHAR_HEIGHT</span><span class="p">),</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">/</span> <span class="n">zy</span><span class="p">)</span>
                <span class="n">text_style</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span><span class="p">,</span>
                    <span class="s1">&#39;text_anchor&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">,</span>
                    <span class="p">}</span>
                <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">text_box</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span>

            <span class="c1"># Update x to draw consecutive motifs</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">w</span></div>
</div>



<div class="viewcode-block" id="AlignmentFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace">[docs]</a>
<span class="k">class</span> <span class="nc">AlignmentFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="AlignmentFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">seqtype</span><span class="o">=</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span>
            <span class="n">gap_format</span><span class="o">=</span><span class="s1">&#39;line&#39;</span><span class="p">,</span> <span class="n">seq_format</span><span class="o">=</span><span class="s1">&#39;[]&#39;</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1"># max height</span>
            <span class="n">fgcolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;#bcc3d0&#39;</span><span class="p">,</span> <span class="n">gapcolor</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
            <span class="n">gap_linewidth</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
            <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqlength</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">=</span> <span class="n">seqtype</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">autoformat</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># block if 1px contains &gt; 1 tile</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">=</span> <span class="n">seq_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span> <span class="o">=</span> <span class="n">gap_format</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gap_linewidth</span> <span class="o">=</span> <span class="n">gap_linewidth</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compress_gaps</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>    <span class="c1"># sum of all regions&#39; width if not provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="n">height</span>  <span class="c1"># dynamically computed if not provided</span>

        <span class="n">total_width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqlength</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">total_width</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">total_width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">bg</span> <span class="o">=</span> <span class="n">_aacolors</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqtype</span> <span class="o">==</span> <span class="s1">&#39;aa&#39;</span> <span class="k">else</span> <span class="n">_ntcolors</span>
        <span class="c1"># self.fgcolor = fgcolor</span>
        <span class="c1"># self.bgcolor = bgcolor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span> <span class="o">=</span> <span class="n">gapcolor</span>

        <span class="c1"># Text</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_min_fsize</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_blocks</span><span class="p">()</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;AlignmentFace&quot;</span>

<div class="viewcode-block" id="AlignmentFace.get_seq">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace.get_seq">[docs]</a>
    <span class="k">def</span> <span class="nf">get_seq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retrieves sequence given start, end&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span></div>


<div class="viewcode-block" id="AlignmentFace.build_blocks">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace.build_blocks">[docs]</a>
    <span class="k">def</span> <span class="nf">build_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">reg</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;([^-]+)&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">reg</span><span class="p">:</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">reg</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">pos</span><span class="p">,</span> <span class="n">pos</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
                <span class="n">pos</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">reg</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span></div>


<div class="viewcode-block" id="AlignmentFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">!=</span> <span class="s1">&#39;branch_right&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">pos</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;aligned&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">InvalidUsage</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Position </span><span class="si">{</span><span class="n">pos</span><span class="si">}</span><span class="s1"> not allowed for SeqMotifFace&#39;</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>

        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>
        <span class="n">zx</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">!=</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="n">zx</span>

            <span class="c1"># zx = drawer.zoom[0]</span>
            <span class="c1"># self.zoom = (zx, zy)</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s2">&quot;circ&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="o">=</span> <span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">zx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="AlignmentFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.AlignmentFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">get_height</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">r</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="ow">or</span> <span class="mf">1e-10</span><span class="p">)</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="mi">1</span>
            <span class="n">default_h</span> <span class="o">=</span> <span class="n">dy</span> <span class="o">*</span> <span class="n">zy</span> <span class="o">*</span> <span class="n">r</span>
            <span class="n">h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="ow">or</span> <span class="n">default_h</span><span class="p">,</span> <span class="n">default_h</span><span class="p">])</span> <span class="o">/</span> <span class="n">zy</span>
            <span class="c1"># h /= r</span>
            <span class="k">return</span> <span class="n">y</span> <span class="o">+</span> <span class="p">(</span><span class="n">dy</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">h</span>

        <span class="c1"># Only leaf/collapsed branch_right or aligned</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>
        <span class="n">zx</span> <span class="o">=</span> <span class="n">drawer</span><span class="o">.</span><span class="n">zoom</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="k">else</span> <span class="n">zx</span>


        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_format</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;line&quot;</span><span class="p">,</span> <span class="s2">&quot;-&quot;</span><span class="p">]:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
                <span class="n">p1</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
                <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gap_linewidth</span><span class="p">,</span>
                                           <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">gapcolor</span><span class="p">})</span>
        <span class="n">vx0</span><span class="p">,</span> <span class="n">vx1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span>
        <span class="n">too_small</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">zx</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seqlength</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">1</span>

        <span class="n">posw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">poswidth</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">w_scale</span>
        <span class="n">viewport_start</span> <span class="o">=</span> <span class="n">vx0</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">/</span> <span class="n">zx</span>
        <span class="n">viewport_end</span> <span class="o">=</span> <span class="n">vx1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">/</span> <span class="n">zx</span>
        <span class="n">sm_x</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">viewport_start</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">sm_start</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">sm_x</span> <span class="o">/</span> <span class="n">posw</span><span class="p">)</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqlength</span> <span class="o">*</span> <span class="n">posw</span>
        <span class="n">sm_x0</span> <span class="o">=</span> <span class="n">x0</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s2">&quot;rect&quot;</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">sm_end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seqlength</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">sm_x0</span> <span class="o">+</span> <span class="n">w</span> <span class="o">-</span> <span class="n">viewport_end</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">posw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">too_small</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">==</span> <span class="s2">&quot;[]&quot;</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">end</span> <span class="o">&gt;=</span> <span class="n">sm_start</span> <span class="ow">and</span> <span class="n">start</span> <span class="o">&lt;=</span> <span class="n">sm_end</span><span class="p">:</span>
                    <span class="n">bstart</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">sm_start</span><span class="p">,</span> <span class="n">start</span><span class="p">)</span>
                    <span class="n">bend</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">sm_end</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
                    <span class="n">bx</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">bstart</span> <span class="o">*</span> <span class="n">posw</span>
                    <span class="n">by</span><span class="p">,</span> <span class="n">bh</span> <span class="o">=</span> <span class="n">get_height</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
                    <span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">bx</span><span class="p">,</span> <span class="n">by</span><span class="p">,</span> <span class="p">(</span><span class="n">bend</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">bstart</span><span class="p">)</span> <span class="o">*</span> <span class="n">posw</span><span class="p">,</span> <span class="n">bh</span><span class="p">)</span>
                    <span class="k">yield</span> <span class="p">[</span> <span class="s2">&quot;pixi-block&quot;</span><span class="p">,</span> <span class="n">box</span> <span class="p">]</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_seq</span><span class="p">(</span><span class="n">sm_start</span><span class="p">,</span> <span class="n">sm_end</span><span class="p">)</span>
            <span class="n">sm_x</span> <span class="o">=</span> <span class="n">sm_x</span> <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;rect&#39;</span> <span class="k">else</span> <span class="n">x0</span>
            <span class="n">y</span><span class="p">,</span> <span class="n">h</span> <span class="o">=</span> <span class="n">get_height</span><span class="p">(</span><span class="n">sm_x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">sm_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">sm_x0</span> <span class="o">+</span> <span class="n">sm_x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">posw</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq</span><span class="p">),</span> <span class="n">h</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">seq_format</span> <span class="o">==</span> <span class="s1">&#39;compactseq&#39;</span> <span class="ow">or</span> <span class="n">posw</span> <span class="o">*</span> <span class="n">zx</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_min_fsize</span><span class="p">:</span>
                <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;notext&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">aa_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span>
            <span class="k">yield</span> <span class="p">[</span> <span class="sa">f</span><span class="s1">&#39;pixi-aa_</span><span class="si">{</span><span class="n">aa_type</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">sm_box</span><span class="p">,</span> <span class="n">seq</span> <span class="p">]</span></div>
</div>




<div class="viewcode-block" id="ScaleFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ScaleFace">[docs]</a>
<span class="k">class</span> <span class="nc">ScaleFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>
<div class="viewcode-block" id="ScaleFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ScaleFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
            <span class="n">scale_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">tick_width</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">formatter</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%.0f</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">=</span> <span class="n">width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">range</span> <span class="o">=</span> <span class="n">scale_range</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="n">color</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="n">min_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">=</span> <span class="n">formatter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tick_width</span> <span class="o">=</span> <span class="n">tick_width</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span> <span class="o">=</span> <span class="n">line_width</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">vt_line_height</span> <span class="o">=</span> <span class="mi">10</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ScaleFace&quot;</span>

<div class="viewcode-block" id="ScaleFace.compute_bounding_box">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ScaleFace.compute_bounding_box">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_bounding_box</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span> <span class="ow">and</span> <span class="nb">abs</span><span class="p">(</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">swap_pos</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="n">box</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">compute_bounding_box</span><span class="p">(</span>
            <span class="n">drawer</span><span class="p">,</span>
            <span class="n">point</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span>
            <span class="n">dx_to_closest_child</span><span class="p">,</span>
            <span class="n">bdx</span><span class="p">,</span> <span class="n">bdy</span><span class="p">,</span>
            <span class="n">bdy0</span><span class="p">,</span> <span class="n">bdy1</span><span class="p">,</span>
            <span class="n">pos</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span>
            <span class="n">n_row</span><span class="p">,</span> <span class="n">n_col</span><span class="p">,</span>
            <span class="n">dx_before</span><span class="p">,</span> <span class="n">dy_before</span><span class="p">)</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="n">box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span> <span class="o">=</span> <span class="p">(</span><span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">drawer</span><span class="o">.</span><span class="n">viewport</span><span class="o">.</span><span class="n">dx</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">height</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">line_width</span> <span class="o">+</span> <span class="mi">10</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span><span class="p">)</span> <span class="o">/</span> <span class="n">zy</span>

        <span class="n">height</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">dy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">height</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">pos</span> <span class="o">==</span> <span class="s2">&quot;aligned_bottom&quot;</span><span class="p">:</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="n">height</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">zx</span><span class="p">,</span> <span class="n">height</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span></div>


<div class="viewcode-block" id="ScaleFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ScaleFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">/</span> <span class="n">zy</span><span class="p">)</span>
        <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vt_line_height</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">zy</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">drawer</span><span class="o">.</span><span class="n">TYPE</span> <span class="o">==</span> <span class="s1">&#39;circ&#39;</span><span class="p">:</span>
            <span class="n">p1</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p1</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="n">cartesian</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>
        <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span><span class="p">,</span>
                                       <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">})</span>


        <span class="n">nticks</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">*</span> <span class="n">zx</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">tick_width</span><span class="p">)</span>
        <span class="n">dx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">/</span> <span class="n">nticks</span>
        <span class="n">range_factor</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">range</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">:</span>
            <span class="n">sm_start</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span> <span class="o">-</span> <span class="n">x0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
            <span class="n">sm_end</span> <span class="o">=</span> <span class="n">nticks</span> <span class="o">-</span> <span class="nb">round</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">width</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">viewport</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">viewport_margin</span><span class="p">),</span> <span class="mi">0</span><span class="p">)</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sm_start</span><span class="p">,</span> <span class="n">sm_end</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">nticks</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">sm_start</span><span class="p">,</span> <span class="n">sm_end</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span>
            <span class="n">number</span> <span class="o">=</span> <span class="n">range_factor</span> <span class="o">*</span> <span class="n">i</span> <span class="o">*</span> <span class="n">dx</span>

            <span class="k">if</span> <span class="n">number</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;0&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">text</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="o">%</span> <span class="n">number</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">formatter</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>

            <span class="n">text</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;.&#39;</span> <span class="ow">in</span> <span class="n">text</span> <span class="k">else</span> <span class="n">text</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tick_width</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">text</span><span class="p">),</span> <span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">)</span>
            <span class="n">text_style</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span><span class="p">,</span>
                <span class="s1">&#39;text_anchor&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span>
                <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span> <span class="c1"># default sans-serif</span>
                <span class="p">}</span>
            <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span>
                    <span class="n">y</span><span class="p">,</span>
                    <span class="c1"># y + (dy - self._fsize / (zy * r)) / 2,</span>
                    <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">text_box</span><span class="p">,</span> <span class="n">text</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span>

            <span class="n">p1</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">vt_line_height</span> <span class="o">/</span> <span class="n">zy</span><span class="p">)</span>
            <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="n">dy</span><span class="p">)</span>

            <span class="k">yield</span> <span class="n">draw_line</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;stroke-width&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">line_width</span><span class="p">,</span>
                                           <span class="s1">&#39;stroke&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">})</span></div>
</div>



<div class="viewcode-block" id="PieChartFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.PieChartFace">[docs]</a>
<span class="k">class</span> <span class="nc">PieChartFace</span><span class="p">(</span><span class="n">CircleFace</span><span class="p">):</span>

<div class="viewcode-block" id="PieChartFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.PieChartFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">radius</span> <span class="o">=</span> <span class="n">radius</span>
        <span class="c1"># Drawing private properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_center</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

        <span class="c1"># data = [ [name, value, color, tooltip], ... ]</span>
        <span class="c1"># self.data = [ (name, value, color, tooltip, a, da) ]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_pie</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">))</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;PieChartFace&quot;</span>

<div class="viewcode-block" id="PieChartFace.compute_pie">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.PieChartFace.compute_pie">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_pie</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
        <span class="n">total_value</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">data</span><span class="p">)</span>

        <span class="n">a</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">tooltip</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
            <span class="n">da</span> <span class="o">=</span> <span class="p">(</span><span class="n">value</span> <span class="o">/</span> <span class="n">total_value</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">da</span><span class="p">))</span>
            <span class="n">a</span> <span class="o">+=</span> <span class="n">da</span>

        <span class="k">assert</span> <span class="n">a</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">-</span> <span class="mf">1e-5</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&lt;=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">pi</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="s2">&quot;Incorrect pie&quot;</span></div>


<div class="viewcode-block" id="PieChartFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.PieChartFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="c1"># Draw circle if only one datum</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">color</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">yield from</span> <span class="n">CircleFace</span><span class="o">.</span><span class="n">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">tooltip</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">da</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
                <span class="n">style</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="n">color</span> <span class="p">}</span>
                <span class="k">yield</span> <span class="n">draw_slice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_center</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_max_radius</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">da</span><span class="p">,</span>
                        <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="n">style</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="HTMLFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.HTMLFace">[docs]</a>
<span class="k">class</span> <span class="nc">HTMLFace</span><span class="p">(</span><span class="n">RectFace</span><span class="p">):</span>
<div class="viewcode-block" id="HTMLFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.HTMLFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">RectFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">html</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;HTMLFace&quot;</span>

<div class="viewcode-block" id="HTMLFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.HTMLFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">draw_html</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ImgFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ImgFace">[docs]</a>
<span class="k">class</span> <span class="nc">ImgFace</span><span class="p">(</span><span class="n">RectFace</span><span class="p">):</span>
<div class="viewcode-block" id="ImgFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ImgFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img_path</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">RectFace</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>



        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">img_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">handle</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">base64</span><span class="o">.</span><span class="n">b64encode</span><span class="p">(</span><span class="n">handle</span><span class="o">.</span><span class="n">read</span><span class="p">())</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">)</span>
        <span class="n">extension</span> <span class="o">=</span> <span class="n">pathlib</span><span class="o">.</span><span class="n">Path</span><span class="p">(</span><span class="n">img_path</span><span class="p">)</span><span class="o">.</span><span class="n">suffix</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">if</span> <span class="n">extension</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ALLOWED_IMG_EXTENSIONS</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The image does not have an allowed format: &quot;</span> <span class="o">+</span>
                    <span class="n">extension</span> <span class="o">+</span> <span class="s2">&quot; not in &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">ALLOWED_IMG_EXTENSIONS</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;data:image/</span><span class="si">{</span><span class="n">extension</span><span class="si">}</span><span class="s1">;base64,</span><span class="si">{</span><span class="n">img</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">stretch</span> <span class="o">=</span> <span class="kc">False</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;ImgFace&quot;</span>

<div class="viewcode-block" id="ImgFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.ImgFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="k">yield</span> <span class="n">draw_img</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="LegendFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.LegendFace">[docs]</a>
<span class="k">class</span> <span class="nc">LegendFace</span><span class="p">(</span><span class="n">Face</span><span class="p">):</span>

<div class="viewcode-block" id="LegendFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.LegendFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">colormap</span><span class="p">,</span>
            <span class="n">title</span><span class="p">,</span>
            <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
            <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">Face</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
                <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_content</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">min_fsize</span> <span class="o">=</span> <span class="n">min_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fsize</span> <span class="o">=</span> <span class="n">max_fsize</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ftype</span> <span class="o">=</span> <span class="n">ftype</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;LegendFace&quot;</span>

<div class="viewcode-block" id="LegendFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.LegendFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_own_variables</span><span class="p">()</span>

        <span class="n">style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">color</span><span class="p">,</span> <span class="s1">&#39;opacity&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">opacity</span><span class="p">}</span>

        <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>
        <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">zoom</span>

        <span class="n">entry_h</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mi">15</span> <span class="o">/</span> <span class="n">zy</span><span class="p">,</span> <span class="n">dy</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">+</span> <span class="mi">2</span><span class="p">))</span>

        <span class="n">title_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">5</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">entry_h</span><span class="p">)</span>
        <span class="n">text_style</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;max_fsize&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_fsize</span><span class="p">(</span><span class="n">title_box</span><span class="o">.</span><span class="n">dx</span><span class="p">,</span> <span class="n">title_box</span><span class="o">.</span><span class="n">dy</span><span class="p">,</span> <span class="n">zx</span><span class="p">,</span> <span class="n">zy</span><span class="p">),</span>
            <span class="s1">&#39;text_anchor&#39;</span><span class="p">:</span> <span class="s1">&#39;middle&#39;</span><span class="p">,</span>
            <span class="s1">&#39;ftype&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">ftype</span><span class="si">}</span><span class="s1">, sans-serif&#39;</span><span class="p">,</span> <span class="c1"># default sans-serif</span>
            <span class="p">}</span>

        <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">title_box</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span>

        <span class="n">entry_y</span> <span class="o">=</span> <span class="n">y</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">entry_h</span>
        <span class="k">for</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">colormap</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">text_box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">entry_y</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">entry_h</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">draw_text</span><span class="p">(</span><span class="n">text_box</span><span class="p">,</span>
                    <span class="n">value</span><span class="p">,</span>
                    <span class="n">style</span><span class="o">=</span><span class="n">text_style</span><span class="p">)</span>
            <span class="n">ty</span> <span class="o">+=</span> <span class="n">entry_h</span></div>
</div>



<div class="viewcode-block" id="StackedBarFace">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.StackedBarFace">[docs]</a>
<span class="k">class</span> <span class="nc">StackedBarFace</span><span class="p">(</span><span class="n">RectFace</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Face to show a series of stacked bars.&quot;&quot;&quot;</span>

<div class="viewcode-block" id="StackedBarFace.__init__">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.StackedBarFace.__init__">[docs]</a>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span>
                 <span class="n">min_fsize</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;sans-serif&#39;</span><span class="p">,</span>
                 <span class="n">padding_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the face.</span>

<span class="sd">        :param data: List of tuples, like [(whatever, value, color), ...].</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="n">height</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">min_fsize</span><span class="o">=</span><span class="n">min_fsize</span><span class="p">,</span> <span class="n">max_fsize</span><span class="o">=</span><span class="n">max_fsize</span><span class="p">,</span>
                         <span class="n">padding_x</span><span class="o">=</span><span class="n">padding_x</span><span class="p">,</span> <span class="n">padding_y</span><span class="o">=</span><span class="n">padding_y</span><span class="p">,</span> <span class="n">tooltip</span><span class="o">=</span><span class="n">tooltip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">data</span></div>


    <span class="k">def</span> <span class="nf">__name__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;StackedBarFace&quot;</span>

<div class="viewcode-block" id="StackedBarFace.draw">
<a class="viewcode-back" href="../../../../reference/reference_smartview.html#ete4.smartview.renderer.faces.StackedBarFace.draw">[docs]</a>
    <span class="k">def</span> <span class="nf">draw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">drawer</span><span class="p">):</span>
        <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dx0</span><span class="p">,</span> <span class="n">dy0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_box</span>

        <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
        <span class="n">scale_factor</span> <span class="o">=</span> <span class="n">dx0</span> <span class="o">/</span> <span class="p">(</span><span class="n">total</span> <span class="ow">or</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># the &quot;or 1&quot; prevents dividing by 0</span>

        <span class="n">x</span> <span class="o">=</span> <span class="n">x0</span>
        <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">:</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">scale_factor</span> <span class="o">*</span> <span class="n">value</span>
            <span class="n">box</span> <span class="o">=</span> <span class="n">Box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y0</span><span class="p">,</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dy0</span><span class="p">)</span>
            <span class="k">yield</span> <span class="n">draw_rect</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;fill&#39;</span><span class="p">:</span> <span class="n">color</span><span class="p">},</span>
                            <span class="n">tooltip</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">+=</span> <span class="n">dx</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">ETE Toolkit</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../about.html">About</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../faqs.html">Frequently Asked Questions (FAQs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../tutorial/index.html">Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../reference/index.html">Reference Guide</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2008 - 2023, The ETE Toolkit Team.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.2.6</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
    </div>

    

    
  </body>
</html>